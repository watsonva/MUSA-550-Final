<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MUSA 550 Quarto Template - Fairbnb</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../analysis/index.html">Analysis</a></li><li class="breadcrumb-item"><a href="../analysis/Fairbnb.html">Fairbnb</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/course-icon.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://nickhand.dev" rel="" title="Personal Website" class="quarto-navigation-tool px-1" aria-label="Personal Website"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/MUSA-550-Fall-2023/" rel="" title="MUSA 550 GitHub" class="quarto-navigation-tool px-1" aria-label="MUSA 550 GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vanarcher_" rel="" title="Van Archer Twitter" class="quarto-navigation-tool px-1" aria-label="Van Archer Twitter"><i class="bi bi-twitter"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About me</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/1-python-code-blocks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python code blocks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/2-static-images.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Showing static visualizations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/3-altair-hvplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Altair and Hvplot Charts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/4-folium.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactive Maps with Folium</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../analysis/Fairbnb.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Fairbnb</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section-1.-analyze-airbnb-data-of-san-franscisco" id="toc-section-1.-analyze-airbnb-data-of-san-franscisco" class="nav-link active" data-scroll-target="#section-1.-analyze-airbnb-data-of-san-franscisco">Section 1. Analyze Airbnb Data of San Franscisco</a>
  <ul class="collapse">
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">1.1 Data Collection</a></li>
  <li><a href="#data-cleaning-formatting-and-transformation" id="toc-data-cleaning-formatting-and-transformation" class="nav-link" data-scroll-target="#data-cleaning-formatting-and-transformation">1.2 Data cleaning, formatting and transformation</a></li>
  <li><a href="#table-distribution-of-san-franscisco-airbnb-data" id="toc-table-distribution-of-san-franscisco-airbnb-data" class="nav-link" data-scroll-target="#table-distribution-of-san-franscisco-airbnb-data">1.3 Table Distribution of San Franscisco Airbnb Data</a></li>
  <li><a href="#spatial-distribution-of-san-franscisco-airbnb-data" id="toc-spatial-distribution-of-san-franscisco-airbnb-data" class="nav-link" data-scroll-target="#spatial-distribution-of-san-franscisco-airbnb-data">1.4 Spatial Distribution of San Franscisco Airbnb Data</a></li>
  </ul></li>
  <li><a href="#section-2.-price-prediction-for-airbnb-host-in-san-franscisco" id="toc-section-2.-price-prediction-for-airbnb-host-in-san-franscisco" class="nav-link" data-scroll-target="#section-2.-price-prediction-for-airbnb-host-in-san-franscisco">Section 2. Price Prediction for Airbnb Host in San Franscisco</a>
  <ul class="collapse">
  <li><a href="#data-exploratory" id="toc-data-exploratory" class="nav-link" data-scroll-target="#data-exploratory">2.1 Data Exploratory</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">2.2 Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#current-feature-investigation" id="toc-current-feature-investigation" class="nav-link" data-scroll-target="#current-feature-investigation">2.2.1 Current Feature Investigation</a></li>
  <li><a href="#feature-collect" id="toc-feature-collect" class="nav-link" data-scroll-target="#feature-collect">2.2.2 Feature Collect</a></li>
  <li><a href="#feature-add" id="toc-feature-add" class="nav-link" data-scroll-target="#feature-add">2.2.3 Feature Add</a></li>
  </ul></li>
  <li><a href="#correlation-analysis" id="toc-correlation-analysis" class="nav-link" data-scroll-target="#correlation-analysis">2.3 Correlation Analysis</a></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building">2.4 Model Building</a></li>
  <li><a href="#predict" id="toc-predict" class="nav-link" data-scroll-target="#predict">2.6 Predict</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/MUSA-550-Fall-2023/quarto-website-template/blob/main/analysis/Fairbnb.ipynb" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fairbnb</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="watson-xin-wang" class="level6">
<h6 class="anchored" data-anchor-id="watson-xin-wang">Watson Xin Wang</h6>
</section>
<section id="musa-5500-final-project" class="level6">
<h6 class="anchored" data-anchor-id="musa-5500-final-project">MUSA-5500 Final Project</h6>
</section>
<section id="section-1.-analyze-airbnb-data-of-san-franscisco" class="level1">
<h1>Section 1. Analyze Airbnb Data of San Franscisco</h1>
<div class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># basic setting</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-collection" class="level3">
<h3 class="anchored" data-anchor-id="data-collection">1.1 Data Collection</h3>
<div class="cell" data-tags="[]" data-execution_count="174">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collect airbnb data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>url_airbnb <span class="op">=</span> <span class="st">"http://data.insideairbnb.com/united-states/ca/san-francisco/2023-09-02/data/listings.csv.gz"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>airbnb_raw <span class="op">=</span> pd.read_csv(url_airbnb, compression<span class="op">=</span><span class="st">'gzip'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="63">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collect neighborhood data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>url_nhood <span class="op">=</span> <span class="st">'http://data.insideairbnb.com/united-states/ca/san-francisco/2023-09-02/visualisations/neighbourhoods.geojson'</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>nhood <span class="op">=</span> gpd.read_file(url_nhood).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).drop(<span class="st">'neighbourhood_group'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>nhood.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Seacliff</td>
<td>MULTIPOLYGON (((-13634866.529 4549507.923, -13...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Haight Ashbury</td>
<td>MULTIPOLYGON (((-13629509.279 4546849.952, -13...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Outer Mission</td>
<td>MULTIPOLYGON (((-13631548.652 4538289.111, -13...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Downtown/Civic Center</td>
<td>MULTIPOLYGON (((-13626497.864 4549820.919, -13...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Diamond Heights</td>
<td>MULTIPOLYGON (((-13629460.632 4542967.028, -13...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(nhood)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>37</code></pre>
</div>
</div>
</section>
<section id="data-cleaning-formatting-and-transformation" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning-formatting-and-transformation">1.2 Data cleaning, formatting and transformation</h3>
<div class="cell" data-tags="[]" data-execution_count="64">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; Data Cleaning | filter 7 categories and 22 in total columns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>columns<span class="op">=</span>[</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># 1 index</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'id'</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'neighbourhood_cleansed'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># 4 host info</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'host_since'</span>, <span class="co"># can translate to years</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'host_response_rate'</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'host_acceptance_rate'</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'host_identity_verified'</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a> <span class="co"># 2 location info</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'latitude'</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'longitude'</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># 3 core info that users mainly make decision on</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'price'</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'accommodates'</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'instant_bookable'</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a> <span class="co"># 4 room info</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'room_type'</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'beds'</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a> <span class="co"># 5 reviews info</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'number_of_reviews'</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'number_of_reviews_l30d'</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'review_scores_rating'</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'last_review'</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'reviews_per_month'</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a> <span class="co"># 3 other info</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'calculated_host_listings_count'</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'minimum_nights'</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'maximum_nights'</span>]</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>airbnb<span class="op">=</span>pd.DataFrame(airbnb_raw, columns<span class="op">=</span>columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="65">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; Data Cleaning |filter NA rows</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print columns with missing values</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>missing_values <span class="op">=</span> airbnb.isna().<span class="bu">sum</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(missing_values[missing_values <span class="op">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># delete NA</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>airbnb<span class="op">=</span>airbnb.dropna(subset<span class="op">=</span>[<span class="st">"host_response_rate"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"host_acceptance_rate"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"beds"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"reviews_per_month"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"last_review"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"review_scores_rating"</span>])</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(airbnb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>host_response_rate      1038
host_acceptance_rate     865
beds                     100
review_scores_rating    1437
last_review             1437
reviews_per_month       1437
dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>5153</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="66">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; Data Formatting</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.0 rename neighbourhood related column</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>airbnb<span class="op">=</span>airbnb.rename(columns<span class="op">=</span>{<span class="st">"neighbourhood_cleansed"</span>:<span class="st">"neighbourhood"</span>})</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.0 transform 'host_since' into datatime year</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>reference_date <span class="op">=</span> pd.Timestamp(<span class="st">'2023-12-18'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'host_year'</span>] <span class="op">=</span> pd.DatetimeIndex(airbnb[<span class="st">'host_since'</span>]).year</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>airbnb.drop(columns<span class="op">=</span>[<span class="st">'host_since'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.0 transform 'last_review' into numeric values indicates days since last review</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'last_review'</span>] <span class="op">=</span> pd.to_datetime(airbnb[<span class="st">'last_review'</span>])</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'last_review_days'</span>] <span class="op">=</span> (reference_date <span class="op">-</span> airbnb[<span class="st">'last_review'</span>]).dt.days</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>airbnb.drop(columns<span class="op">=</span>[<span class="st">'last_review'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.0 transform 'price' into numeric column</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'price'</span>] <span class="op">=</span> airbnb[<span class="st">'price'</span>].<span class="bu">str</span>.extract(<span class="st">'(\d+)'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'price'</span>] <span class="op">=</span> airbnb[<span class="st">'price'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.0 transform 'host_response_rate' and 'host_acceptance_rate' into numeric column</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'host_response_rate'</span>]<span class="op">=</span> airbnb[<span class="st">'host_response_rate'</span>].<span class="bu">str</span>.extract(<span class="st">'(\d+)'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'host_response_rate'</span>] <span class="op">=</span> airbnb[<span class="st">'host_response_rate'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'host_acceptance_rate'</span>]<span class="op">=</span> airbnb[<span class="st">'host_acceptance_rate'</span>].<span class="bu">str</span>.extract(<span class="st">'(\d+)'</span>, expand<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'host_acceptance_rate'</span>] <span class="op">=</span> airbnb[<span class="st">'host_acceptance_rate'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.0 convert the data type</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'reviews_per_month'</span>] <span class="op">=</span> airbnb[<span class="st">'reviews_per_month'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'accommodates'</span>] <span class="op">=</span> airbnb[<span class="st">'accommodates'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.0 calculate price per person </span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">'price_per_person'</span>]<span class="op">=</span>airbnb[<span class="st">"price"</span>]<span class="op">/</span>airbnb[<span class="st">"accommodates"</span>]</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 8.0 add the count field</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">"count"</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>airbnb.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">host_acceptance_rate</th>
<th data-quarto-table-cell-role="th">host_identity_verified</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">number_of_reviews_l30d</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">host_year</th>
<th data-quarto-table-cell-role="th">last_review_days</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>958</td>
<td>Western Addition</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.77028</td>
<td>-122.43317</td>
<td>187</td>
<td>3</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>405</td>
<td>1</td>
<td>4.87</td>
<td>2.36</td>
<td>1</td>
<td>2</td>
<td>30</td>
<td>2008</td>
<td>133</td>
<td>62.333333</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5858</td>
<td>Bernal Heights</td>
<td>80.0</td>
<td>71.0</td>
<td>t</td>
<td>37.74474</td>
<td>-122.42089</td>
<td>235</td>
<td>4</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>111</td>
<td>0</td>
<td>4.88</td>
<td>0.64</td>
<td>1</td>
<td>30</td>
<td>60</td>
<td>2009</td>
<td>2325</td>
<td>58.750000</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8142</td>
<td>Haight Ashbury</td>
<td>100.0</td>
<td>88.0</td>
<td>t</td>
<td>37.76555</td>
<td>-122.45213</td>
<td>56</td>
<td>1</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>10</td>
<td>0</td>
<td>4.70</td>
<td>0.09</td>
<td>15</td>
<td>32</td>
<td>90</td>
<td>2009</td>
<td>141</td>
<td>56.000000</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8339</td>
<td>Western Addition</td>
<td>100.0</td>
<td>0.0</td>
<td>t</td>
<td>37.77564</td>
<td>-122.43642</td>
<td>480</td>
<td>2</td>
<td>f</td>
<td>Entire home/apt</td>
<td>1.0</td>
<td>28</td>
<td>0</td>
<td>4.87</td>
<td>0.16</td>
<td>2</td>
<td>5</td>
<td>91</td>
<td>2009</td>
<td>1634</td>
<td>240.000000</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8739</td>
<td>Mission</td>
<td>100.0</td>
<td>96.0</td>
<td>t</td>
<td>37.76030</td>
<td>-122.42197</td>
<td>122</td>
<td>3</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>792</td>
<td>5</td>
<td>4.92</td>
<td>4.62</td>
<td>2</td>
<td>1</td>
<td>26</td>
<td>2009</td>
<td>119</td>
<td>40.666667</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="table-distribution-of-san-franscisco-airbnb-data" class="level3">
<h3 class="anchored" data-anchor-id="table-distribution-of-san-franscisco-airbnb-data">1.3 Table Distribution of San Franscisco Airbnb Data</h3>
<div class="cell" data-tags="[]" data-execution_count="73">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="90">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Firstly, we investage the relationship between `host_year` and `room_type` via `counts`</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 1.0 Data Wrangling</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># group by the "host_year" and "room_type" columns and calculates the size (count) of each group </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>group_year<span class="op">=</span>airbnb.groupby([<span class="st">"host_year"</span>,<span class="st">"room_type"</span>]).size() </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the series into a DataFrame</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>groupyear<span class="op">=</span>pd.DataFrame(group_year)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the column name</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>groupyear<span class="op">=</span>groupyear.rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">"count"</span>})</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># reset the index ( grouped dataframe usually will have a multi-level index which is inconvenient</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>groupyear<span class="op">=</span>groupyear.reset_index()</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 2.0 plot setting</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the figure and axes</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>fx,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">6</span>))</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the gtid style and font size</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">'darkgrid'</span>,font_scale<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the color map</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {<span class="st">"Entire home/apt"</span>: <span class="st">"red"</span>, <span class="st">"Private room"</span>: <span class="st">"black"</span>, <span class="st">"Shared room"</span>:<span class="st">"blue"</span>, <span class="st">"Hotel room"</span>:<span class="st">"yellow"</span>}</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [color_map[room_type] <span class="cf">for</span> room_type <span class="kw">in</span> airbnb[<span class="st">"room_type"</span>]]</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>style <span class="op">=</span> <span class="bu">dict</span>(palette<span class="op">=</span>color_map)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the line</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(x<span class="op">=</span><span class="st">'host_year'</span>,y<span class="op">=</span><span class="st">'count'</span>,hue<span class="op">=</span><span class="st">"room_type"</span>,markers<span class="op">=</span><span class="va">True</span>,data<span class="op">=</span>groupyear,<span class="op">**</span>style)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend and informative axis label</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>ax.legend(ncol<span class="op">=</span><span class="dv">1</span>, loc<span class="op">=</span><span class="st">"upper right"</span>, frameon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">"count"</span>,xlabel<span class="op">=</span><span class="st">"host_year"</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Distribution of Hoster Count by Different Room Types and Host Year"</span>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 3.0 save plot</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>figure <span class="op">=</span> ax.get_figure() </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>figure.savefig(<span class="st">"./diagram/host_year_count.png"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="91">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Secondly, we investigate the distribution of price</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 1.0 plot setting</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the figure and axes</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>fx,ax<span class="op">=</span>plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">6</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the gtid style and font size</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">'darkgrid'</span>,font_scale<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the histogram</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>sns.distplot(airbnb[<span class="st">"price"</span>],color<span class="op">=</span><span class="st">"#990000"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the axis label</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">"count"</span>,xlabel<span class="op">=</span><span class="st">"price"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Distribution of Airbnb Price in San Franscisco "</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 2.0 plot setting</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>figure <span class="op">=</span> ax.get_figure() </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>figure.savefig(<span class="st">"./diagram/distribution_price.png"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/48/lbx6gdh15879t7nnkfxf04z00000gn/T/ipykernel_36709/3167881669.py:10: UserWarning: 

`distplot` is a deprecated function and will be removed in seaborn v0.14.0.

Please adapt your code to use either `displot` (a figure-level function with
similar flexibility) or `histplot` (an axes-level function for histograms).

For a guide to updating your code to use the new functions, please see
https://gist.github.com/mwaskom/de44147ed2974457ad6372750bbe5751

  sns.distplot(airbnb["price"],color="#990000")</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-11-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="92">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Thirdly, we investigate the distribution of price by roomtype</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axis object</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the Seaborn style and font size</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">'darkgrid'</span>, font_scale<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boxplot</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">"room_type"</span>, y<span class="op">=</span><span class="st">"price"</span>, data<span class="op">=</span>airbnb, color<span class="op">=</span><span class="st">"#990000"</span>, fliersize<span class="op">=</span><span class="dv">1</span>, linewidth<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels for y-axis and x-axis</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">"Price"</span>, xlabel<span class="op">=</span><span class="st">"Room Type"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of Airbnb price by Room Type in San Franscisco"</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>figure <span class="op">=</span> ax.get_figure() </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>figure.savefig(<span class="st">"./diagram/distribution_price_byroomtype.png"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="102">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axis object</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the Seaborn style and font size</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">'darkgrid'</span>, font_scale<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define your color mapping dictionary</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {<span class="st">"Entire home/apt"</span>: <span class="st">"#FF5733"</span>, <span class="st">"Private room"</span>: <span class="st">"#000000"</span>, <span class="st">"Shared room"</span>:<span class="st">"#4287f5"</span>, <span class="st">"Hotel room"</span>:<span class="st">"#FFC300"</span>}</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define style parameters</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>style <span class="op">=</span> <span class="bu">dict</span>(palette<span class="op">=</span>color_map, edgecolor<span class="op">=</span><span class="st">"none"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the points using sns.scatterplot</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">"number_of_reviews"</span>, y<span class="op">=</span><span class="st">"price"</span>, hue<span class="op">=</span><span class="st">"room_type"</span>, data<span class="op">=</span>airbnb, ax<span class="op">=</span>ax, <span class="op">**</span>style)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend and informative axis labels</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>ax.legend(ncol<span class="op">=</span><span class="dv">1</span>, loc<span class="op">=</span><span class="st">"upper right"</span>, frameon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">"Price"</span>, xlabel<span class="op">=</span><span class="st">"Number of Reviews"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>figure <span class="op">=</span> ax.get_figure() </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>figure.savefig(<span class="st">"./diagram/distribution_price_byreviews.png"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="spatial-distribution-of-san-franscisco-airbnb-data" class="level3">
<h3 class="anchored" data-anchor-id="spatial-distribution-of-san-franscisco-airbnb-data">1.4 Spatial Distribution of San Franscisco Airbnb Data</h3>
<div class="cell" data-tags="[]" data-execution_count="20">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define basemap in folium</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium.plugins <span class="im">import</span> HeatMap</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generateBaseMap_black(default_location<span class="op">=</span>[<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>], default_zoom_start<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    base_map <span class="op">=</span> folium.Map(location<span class="op">=</span>default_location, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                          control_scale<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                          zoom_start<span class="op">=</span>default_zoom_start,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                          tiles<span class="op">=</span><span class="st">'CartoDB dark_matter'</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                          attr<span class="op">=</span><span class="st">"default"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the locations of Airbnb</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>base_map<span class="op">=</span>generateBaseMap_black()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>air_point <span class="op">=</span> folium.<span class="bu">map</span>.FeatureGroup()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> lat, lng, <span class="kw">in</span> <span class="bu">zip</span>(airbnb.latitude, airbnb.longitude):</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    air_point.add_child(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        folium.CircleMarker(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            [lat, lng],</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            radius<span class="op">=</span><span class="dv">1</span>, <span class="co"># define how big the circle markers to be</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">"none"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            fill<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>            fill_color<span class="op">=</span><span class="st">'#339999'</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            fill_opacity<span class="op">=</span><span class="fl">0.4</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>folium_overview<span class="op">=</span>base_map.add_child(air_point)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>folium_overview.save(<span class="st">"./diagram/spatial_distribution.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the airbnb count by neighborhood</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>nhood_count<span class="op">=</span>airbnb.groupby([<span class="st">"nhood"</span>])[<span class="st">"count"</span>].<span class="bu">sum</span>()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>nhood_count<span class="op">=</span>pd.DataFrame(nhood_count).reset_index()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>nhood_count.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nhood</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Bayview</td>
<td>131</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Bernal Heights</td>
<td>244</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Castro/Upper Market</td>
<td>231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Chinatown</td>
<td>84</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Crocker Amazon</td>
<td>38</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the airbnb count by neighbourhood</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>base_map<span class="op">=</span>generateBaseMap_black()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>nei_geo<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>url_nhood<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>folium.Choropleth(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    geo_data<span class="op">=</span>nei_geo,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>nhood_count,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">'nhood'</span>,<span class="st">'count'</span>],</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    key_on<span class="op">=</span><span class="st">'feature.properties.neighbourhood'</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    fill_color<span class="op">=</span><span class="st">'GnBu'</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    fill_opacity<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    line_color<span class="op">=</span><span class="st">"#339999"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    line_opacity<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    highlight<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    legend_name<span class="op">=</span><span class="st">'Airbnb Count by neighbourhood'</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>).add_to(base_map)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>base_map.save(<span class="st">"./diagram/spatial_distribution_bynhood.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="section-2.-price-prediction-for-airbnb-host-in-san-franscisco" class="level1">
<h1>Section 2. Price Prediction for Airbnb Host in San Franscisco</h1>
<section id="data-exploratory" class="level2">
<h2 class="anchored" data-anchor-id="data-exploratory">2.1 Data Exploratory</h2>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 1.0 Convert the airbnb data into geodataframe</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">"coordinate"</span>]<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(airbnb[<span class="st">"longitude"</span>],airbnb[<span class="st">"latitude"</span>]))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>airbnb[<span class="st">"coordinate"</span>]<span class="op">=</span>airbnb[<span class="st">"coordinate"</span>].<span class="bu">apply</span>(Point)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>airbnb_gpd<span class="op">=</span>gpd.GeoDataFrame(airbnb,geometry<span class="op">=</span><span class="st">"coordinate"</span>,crs<span class="op">=</span>{<span class="st">'init'</span>: <span class="st">'epsg:4326'</span>}).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>airbnb_gpd.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/watson/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/pyproj/crs/crs.py:141: FutureWarning: '+init=&lt;authority&gt;:&lt;code&gt;' syntax is deprecated. '&lt;authority&gt;:&lt;code&gt;' is the preferred initialization method. When making the change, be mindful of axis order changes: https://pyproj4.github.io/pyproj/stable/gotchas.html#axis-order-changes-in-proj-6
  in_crs_string = _prepare_from_proj_string(in_crs_string)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="87">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">host_acceptance_rate</th>
<th data-quarto-table-cell-role="th">host_identity_verified</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">number_of_reviews_l30d</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">host_year</th>
<th data-quarto-table-cell-role="th">last_review_days</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">coordinate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>958</td>
<td>Western Addition</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.77028</td>
<td>-122.43317</td>
<td>187</td>
<td>3</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>405</td>
<td>1</td>
<td>4.87</td>
<td>2.36</td>
<td>1</td>
<td>2</td>
<td>30</td>
<td>2008</td>
<td>133</td>
<td>62.333333</td>
<td>1</td>
<td>POINT (-13629198.141 4547024.716)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5858</td>
<td>Bernal Heights</td>
<td>80.0</td>
<td>71.0</td>
<td>t</td>
<td>37.74474</td>
<td>-122.42089</td>
<td>235</td>
<td>4</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>111</td>
<td>0</td>
<td>4.88</td>
<td>0.64</td>
<td>1</td>
<td>30</td>
<td>60</td>
<td>2009</td>
<td>2325</td>
<td>58.750000</td>
<td>1</td>
<td>POINT (-13627831.137 4543428.629)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8142</td>
<td>Haight Ashbury</td>
<td>100.0</td>
<td>88.0</td>
<td>t</td>
<td>37.76555</td>
<td>-122.45213</td>
<td>56</td>
<td>1</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>10</td>
<td>0</td>
<td>4.70</td>
<td>0.09</td>
<td>15</td>
<td>32</td>
<td>90</td>
<td>2009</td>
<td>141</td>
<td>56.000000</td>
<td>1</td>
<td>POINT (-13631308.758 4546358.628)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8339</td>
<td>Western Addition</td>
<td>100.0</td>
<td>0.0</td>
<td>t</td>
<td>37.77564</td>
<td>-122.43642</td>
<td>480</td>
<td>2</td>
<td>f</td>
<td>Entire home/apt</td>
<td>1.0</td>
<td>28</td>
<td>0</td>
<td>4.87</td>
<td>0.16</td>
<td>2</td>
<td>5</td>
<td>91</td>
<td>2009</td>
<td>1634</td>
<td>240.000000</td>
<td>1</td>
<td>POINT (-13629559.929 4547779.573)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8739</td>
<td>Mission</td>
<td>100.0</td>
<td>96.0</td>
<td>t</td>
<td>37.76030</td>
<td>-122.42197</td>
<td>122</td>
<td>3</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>792</td>
<td>5</td>
<td>4.92</td>
<td>4.62</td>
<td>2</td>
<td>1</td>
<td>26</td>
<td>2009</td>
<td>119</td>
<td>40.666667</td>
<td>1</td>
<td>POINT (-13627951.362 4545619.363)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; Clean the airbnb_gpd data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">21</span>,<span class="dv">6</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>chart<span class="op">=</span>sns.distplot(airbnb_gpd[<span class="st">'price'</span>], ax<span class="op">=</span>axes[<span class="dv">0</span>],color<span class="op">=</span><span class="st">"#990000"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>chart<span class="op">=</span>sns.distplot(np.log1p(airbnb_gpd[<span class="st">'price'</span>]), ax<span class="op">=</span>axes[<span class="dv">1</span>],color<span class="op">=</span><span class="st">"#990000"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'log(1+price)'</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>sm.qqplot(np.log1p(airbnb_gpd[<span class="st">'price'</span>]), stats.norm, fit<span class="op">=</span><span class="va">True</span>, line<span class="op">=</span><span class="st">'45'</span>,color<span class="op">=</span><span class="st">"#990000"</span>,alpha<span class="op">=</span><span class="fl">0.5</span>,ax<span class="op">=</span>axes[<span class="dv">2</span>])</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>figure <span class="op">=</span> chart.get_figure() </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>figure.savefig(<span class="st">"./diagram/price_histogram.png"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/48/lbx6gdh15879t7nnkfxf04z00000gn/T/ipykernel_1960/2470584149.py:9: UserWarning: 

`distplot` is a deprecated function and will be removed in seaborn v0.14.0.

Please adapt your code to use either `displot` (a figure-level function with
similar flexibility) or `histplot` (an axes-level function for histograms).

For a guide to updating your code to use the new functions, please see
https://gist.github.com/mwaskom/de44147ed2974457ad6372750bbe5751

  chart=sns.distplot(airbnb_gpd['price'], ax=axes[0],color="#990000")
/var/folders/48/lbx6gdh15879t7nnkfxf04z00000gn/T/ipykernel_1960/2470584149.py:10: UserWarning: 

`distplot` is a deprecated function and will be removed in seaborn v0.14.0.

Please adapt your code to use either `displot` (a figure-level function with
similar flexibility) or `histplot` (an axes-level function for histograms).

For a guide to updating your code to use the new functions, please see
https://gist.github.com/mwaskom/de44147ed2974457ad6372750bbe5751

  chart=sns.distplot(np.log1p(airbnb_gpd['price']), ax=axes[1],color="#990000")
/Users/watson/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/statsmodels/graphics/gofplots.py:1045: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "b" (-&gt; color=(0.0, 0.0, 1.0, 1)). The keyword argument will take precedence.
  ax.plot(x, y, fmt, **plot_style)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-19-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>airbnb_gpd <span class="op">=</span> airbnb_gpd [(np.log1p(airbnb_gpd [<span class="st">'price'</span>]) <span class="op">&lt;</span> <span class="dv">8</span>) <span class="op">&amp;</span> (np.log1p(airbnb_gpd [<span class="st">'price'</span>]) <span class="op">&gt;</span><span class="dv">3</span>)]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>airbnb_gpd<span class="op">=</span>airbnb_gpd.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="29">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(airbnb_gpd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>5054</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="225">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create the axes</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot a random sample of potholes</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>airbnb_gpd.plot(ax<span class="op">=</span>ax, </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="st">'.'</span>, </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">"price"</span> ,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">"GnBu"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                legend_kwds<span class="op">=</span><span class="bu">dict</span>(loc<span class="op">=</span><span class="st">'upper left'</span>),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                scheme<span class="op">=</span><span class="st">"Quantiles"</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                k<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co"># add the Neighbor boundary</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW: plot the basemap underneath</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">#CartoDB.Positron</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># remove axis lines</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Price Distribution of Airbnb in SF (Quantiles: k = 5)"</span>,fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'./diagram/detail/price_points'</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="67">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spatial join</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>airbnb_nhood<span class="op">=</span>gpd.sjoin(airbnb_gpd,nhood,op<span class="op">=</span><span class="st">"within"</span>,how<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>airbnb_nhood.reset_index().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/watson/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/IPython/core/interactiveshell.py:3448: FutureWarning: The `op` parameter is deprecated and will be removed in a future release. Please use the `predicate` parameter instead.
  if await self.run_code(code, result, async_=asy):</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">index_left</th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">nhood</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">host_acceptance_rate</th>
<th data-quarto-table-cell-role="th">host_identity_verified</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">number_of_reviews_l30d</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">host_year</th>
<th data-quarto-table-cell-role="th">last_review_days</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>518.0</td>
<td>2.254431e+06</td>
<td>Seacliff</td>
<td>100.0</td>
<td>98.0</td>
<td>t</td>
<td>37.77641</td>
<td>-122.50991</td>
<td>535.0</td>
<td>8.0</td>
<td>f</td>
<td>Entire home/apt</td>
<td>4.0</td>
<td>51.0</td>
<td>0.0</td>
<td>4.90</td>
<td>0.45</td>
<td>2.0</td>
<td>1.0</td>
<td>1125.0</td>
<td>2014.0</td>
<td>211.0</td>
<td>66.875000</td>
<td>1.0</td>
<td>Seacliff</td>
<td>MULTIPOLYGON (((-13634866.529 4549507.923, -13...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>1048.0</td>
<td>8.352275e+06</td>
<td>Seacliff</td>
<td>100.0</td>
<td>98.0</td>
<td>t</td>
<td>37.78006</td>
<td>-122.50905</td>
<td>134.0</td>
<td>2.0</td>
<td>t</td>
<td>Private room</td>
<td>1.0</td>
<td>718.0</td>
<td>5.0</td>
<td>4.94</td>
<td>7.41</td>
<td>2.0</td>
<td>1.0</td>
<td>1125.0</td>
<td>2014.0</td>
<td>112.0</td>
<td>67.000000</td>
<td>1.0</td>
<td>Seacliff</td>
<td>MULTIPOLYGON (((-13634866.529 4549507.923, -13...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>6146.0</td>
<td>7.689811e+17</td>
<td>Seacliff</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.78247</td>
<td>-122.49269</td>
<td>107.0</td>
<td>3.0</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>45.0</td>
<td>5.0</td>
<td>4.93</td>
<td>5.23</td>
<td>1.0</td>
<td>1.0</td>
<td>28.0</td>
<td>2022.0</td>
<td>122.0</td>
<td>35.666667</td>
<td>1.0</td>
<td>Seacliff</td>
<td>MULTIPOLYGON (((-13634866.529 4549507.923, -13...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>1844.0</td>
<td>1.958800e+07</td>
<td>Seacliff</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.78449</td>
<td>-122.48855</td>
<td>429.0</td>
<td>5.0</td>
<td>f</td>
<td>Entire home/apt</td>
<td>3.0</td>
<td>24.0</td>
<td>0.0</td>
<td>4.96</td>
<td>0.34</td>
<td>18.0</td>
<td>3.0</td>
<td>21.0</td>
<td>2011.0</td>
<td>138.0</td>
<td>85.800000</td>
<td>1.0</td>
<td>Seacliff</td>
<td>MULTIPOLYGON (((-13634866.529 4549507.923, -13...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>1610.0</td>
<td>1.657052e+07</td>
<td>Seacliff</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.78732</td>
<td>-122.49336</td>
<td>154.0</td>
<td>2.0</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>148.0</td>
<td>3.0</td>
<td>4.88</td>
<td>1.86</td>
<td>1.0</td>
<td>2.0</td>
<td>14.0</td>
<td>2014.0</td>
<td>108.0</td>
<td>77.000000</td>
<td>1.0</td>
<td>Seacliff</td>
<td>MULTIPOLYGON (((-13634866.529 4549507.923, -13...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="226">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the airbnb count by neighborhood</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>group<span class="op">=</span>airbnb.groupby([<span class="st">"neighbourhood"</span>])[<span class="st">"price"</span>].mean()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>group<span class="op">=</span>pd.DataFrame(group).reset_index()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>group<span class="op">=</span>nhood.merge(group,on<span class="op">=</span><span class="st">"neighbourhood"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>group<span class="op">=</span>group.rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">"count"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="227">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Needed to line up the colorbar properly</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1 <span class="im">import</span> make_axes_locatable</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the figure</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>),facecolor<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>group.plot( ax<span class="op">=</span>ax,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"price"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    legend_kwds<span class="op">=</span><span class="bu">dict</span>(loc<span class="op">=</span><span class="st">'upper left'</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"GnBu"</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    scheme<span class="op">=</span><span class="st">"Quantiles"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the limits of the GeoDataFrame</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>xmin, ymin, xmax, ymax <span class="op">=</span> group.total_bounds</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the basemap underneath</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Format</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Average Airbnb Price by neighborhood, SF (Quantiles: k = 5)"</span>,size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'./diagram/detail/price_average_nhood'</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="247">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot two columns</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>), facecolor<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted values</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>airbnb_gpd.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>], </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                column<span class="op">=</span><span class="st">'price'</span>, </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="st">'.'</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span><span class="st">"GnBu"</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>                legend_kwds<span class="op">=</span><span class="bu">dict</span>(loc<span class="op">=</span><span class="st">'upper left'</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>                scheme<span class="op">=</span><span class="st">"Quantiles"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>                k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>], edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>axs[<span class="dv">0</span>], crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">"Airbnb Price Distribution by Points in SF "</span>,size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual values</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>group.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>],</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>           column<span class="op">=</span><span class="st">"price"</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>           edgecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>           alpha<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>           legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>           legend_kwds<span class="op">=</span><span class="bu">dict</span>(loc<span class="op">=</span><span class="st">'upper left'</span>),</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>           cmap<span class="op">=</span><span class="st">"GnBu"</span>,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>           scheme<span class="op">=</span><span class="st">"Quantiles"</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>           k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>], edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, facecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>axs[<span class="dv">1</span>], crs<span class="op">=</span>group.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">"Airbnb Average Price Distribution by Neighborhood in SF"</span>,size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Format</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Average Airbnb Price by neighborhood, SF (Quantiles: k = 5)"</span>,size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'./diagram/detail/price_average_nhood'</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="259">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>airbnb_gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="259">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">host_acceptance_rate</th>
<th data-quarto-table-cell-role="th">host_identity_verified</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">number_of_reviews_l30d</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">host_year</th>
<th data-quarto-table-cell-role="th">last_review_days</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">coordinate</th>
<th data-quarto-table-cell-role="th">log_crime</th>
<th data-quarto-table-cell-role="th">log_311</th>
<th data-quarto-table-cell-role="th">log_art</th>
<th data-quarto-table-cell-role="th">log_park</th>
<th data-quarto-table-cell-role="th">log_bike</th>
<th data-quarto-table-cell-role="th">log_resta</th>
<th data-quarto-table-cell-role="th">LaggedPrice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>958</td>
<td>Western Addition</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.770280</td>
<td>-122.433170</td>
<td>187</td>
<td>3</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>405</td>
<td>1</td>
<td>4.87</td>
<td>2.36</td>
<td>1</td>
<td>2</td>
<td>30</td>
<td>2008</td>
<td>133</td>
<td>62.333333</td>
<td>1</td>
<td>POINT (-13629198.141 4547024.716)</td>
<td>2.438247</td>
<td>2.473138</td>
<td>2.626526</td>
<td>2.793330</td>
<td>2.350033</td>
<td>2.371349</td>
<td>370.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5858</td>
<td>Bernal Heights</td>
<td>80.0</td>
<td>71.0</td>
<td>t</td>
<td>37.744740</td>
<td>-122.420890</td>
<td>235</td>
<td>4</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>111</td>
<td>0</td>
<td>4.88</td>
<td>0.64</td>
<td>1</td>
<td>30</td>
<td>60</td>
<td>2009</td>
<td>2325</td>
<td>58.750000</td>
<td>1</td>
<td>POINT (-13627831.137 4543428.629)</td>
<td>2.386006</td>
<td>2.695961</td>
<td>2.157961</td>
<td>2.722494</td>
<td>2.092105</td>
<td>1.958029</td>
<td>104.75</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8142</td>
<td>Haight Ashbury</td>
<td>100.0</td>
<td>88.0</td>
<td>t</td>
<td>37.765550</td>
<td>-122.452130</td>
<td>56</td>
<td>1</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>10</td>
<td>0</td>
<td>4.70</td>
<td>0.09</td>
<td>15</td>
<td>32</td>
<td>90</td>
<td>2009</td>
<td>141</td>
<td>56.000000</td>
<td>1</td>
<td>POINT (-13631308.758 4546358.628)</td>
<td>2.584913</td>
<td>2.408406</td>
<td>2.950024</td>
<td>2.848271</td>
<td>2.450163</td>
<td>2.683513</td>
<td>79.75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8339</td>
<td>Western Addition</td>
<td>100.0</td>
<td>0.0</td>
<td>t</td>
<td>37.775640</td>
<td>-122.436420</td>
<td>480</td>
<td>2</td>
<td>f</td>
<td>Entire home/apt</td>
<td>1.0</td>
<td>28</td>
<td>0</td>
<td>4.87</td>
<td>0.16</td>
<td>2</td>
<td>5</td>
<td>91</td>
<td>2009</td>
<td>1634</td>
<td>240.000000</td>
<td>1</td>
<td>POINT (-13629559.929 4547779.573)</td>
<td>2.416063</td>
<td>2.463375</td>
<td>2.907497</td>
<td>2.852972</td>
<td>2.242407</td>
<td>2.565325</td>
<td>222.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8739</td>
<td>Mission</td>
<td>100.0</td>
<td>96.0</td>
<td>t</td>
<td>37.760300</td>
<td>-122.421970</td>
<td>122</td>
<td>3</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>792</td>
<td>5</td>
<td>4.92</td>
<td>4.62</td>
<td>2</td>
<td>1</td>
<td>26</td>
<td>2009</td>
<td>119</td>
<td>40.666667</td>
<td>1</td>
<td>POINT (-13627951.362 4545619.363)</td>
<td>2.365501</td>
<td>2.327283</td>
<td>2.605696</td>
<td>2.718618</td>
<td>2.174633</td>
<td>2.350898</td>
<td>167.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7316</td>
<td>954536562110561560</td>
<td>Outer Richmond</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.775050</td>
<td>-122.504760</td>
<td>156</td>
<td>2</td>
<td>t</td>
<td>Entire home/apt</td>
<td>1.0</td>
<td>1</td>
<td>1</td>
<td>5.00</td>
<td>1.00</td>
<td>2</td>
<td>2</td>
<td>365</td>
<td>2022</td>
<td>126</td>
<td>78.000000</td>
<td>1</td>
<td>POINT (-13637167.503 4547696.480)</td>
<td>2.752892</td>
<td>2.585617</td>
<td>2.806563</td>
<td>2.993813</td>
<td>2.780875</td>
<td>2.818899</td>
<td>179.75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7325</td>
<td>956723436929813205</td>
<td>West of Twin Peaks</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.739010</td>
<td>-122.459720</td>
<td>85</td>
<td>2</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>2</td>
<td>2</td>
<td>5.00</td>
<td>2.00</td>
<td>1</td>
<td>1</td>
<td>365</td>
<td>2013</td>
<td>121</td>
<td>42.500000</td>
<td>1</td>
<td>POINT (-13632153.673 4542622.003)</td>
<td>3.034106</td>
<td>2.961032</td>
<td>2.807492</td>
<td>2.937599</td>
<td>2.885993</td>
<td>2.931688</td>
<td>217.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7335</td>
<td>958209683596711862</td>
<td>Western Addition</td>
<td>96.0</td>
<td>100.0</td>
<td>t</td>
<td>37.775320</td>
<td>-122.426232</td>
<td>349</td>
<td>8</td>
<td>f</td>
<td>Entire home/apt</td>
<td>4.0</td>
<td>1</td>
<td>1</td>
<td>5.00</td>
<td>1.00</td>
<td>1</td>
<td>2</td>
<td>29</td>
<td>2023</td>
<td>123</td>
<td>43.625000</td>
<td>1</td>
<td>POINT (-13628425.786 4547734.488)</td>
<td>2.325797</td>
<td>2.315855</td>
<td>2.334511</td>
<td>2.415255</td>
<td>2.192144</td>
<td>2.163095</td>
<td>277.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7361</td>
<td>963333324421869755</td>
<td>Parkside</td>
<td>100.0</td>
<td>96.0</td>
<td>t</td>
<td>37.744915</td>
<td>-122.470770</td>
<td>292</td>
<td>6</td>
<td>f</td>
<td>Entire home/apt</td>
<td>3.0</td>
<td>1</td>
<td>1</td>
<td>5.00</td>
<td>1.00</td>
<td>2</td>
<td>2</td>
<td>29</td>
<td>2014</td>
<td>113</td>
<td>48.666667</td>
<td>1</td>
<td>POINT (-13633383.793 4543453.325)</td>
<td>2.934890</td>
<td>2.919877</td>
<td>2.865255</td>
<td>2.899035</td>
<td>2.871728</td>
<td>2.872753</td>
<td>195.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7366</td>
<td>964458312280841640</td>
<td>Financial District</td>
<td>100.0</td>
<td>97.0</td>
<td>t</td>
<td>37.788338</td>
<td>-122.393760</td>
<td>315</td>
<td>4</td>
<td>f</td>
<td>Entire home/apt</td>
<td>1.0</td>
<td>1</td>
<td>1</td>
<td>5.00</td>
<td>1.00</td>
<td>1</td>
<td>2</td>
<td>365</td>
<td>2023</td>
<td>112</td>
<td>78.750000</td>
<td>1</td>
<td>POINT (-13624811.028 4549568.113)</td>
<td>2.644253</td>
<td>1.843581</td>
<td>2.715202</td>
<td>2.947282</td>
<td>2.466224</td>
<td>2.395720</td>
<td>182.00</td>
</tr>
</tbody>
</table>

<p>5153 rows × 31 columns</p>
</div>
</div>
</div>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">2.2 Feature Engineering</h2>
<section id="current-feature-investigation" class="level3">
<h3 class="anchored" data-anchor-id="current-feature-investigation">2.2.1 Current Feature Investigation</h3>
<div class="cell" data-tags="[]" data-execution_count="93">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; Firstly, we investigate distribution of each feature</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> missingno <span class="im">as</span> msno</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>msno.bar(airbnb_gpd[airbnb.columns])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-28-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="feature-collect" class="level3">
<h3 class="anchored" data-anchor-id="feature-collect">2.2.2 Feature Collect</h3>
<p>Data Source: https://www.sf.gov/departments/city-administrator/datasf</p>
<p>Add the following XX datasets: - Crime - 311 - Civic Art Collection - Recreation and Parks Properties - Bicycle Parking - Restaurant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="150">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 1.0 Add Crime data</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data during URL</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>url_crime <span class="op">=</span> <span class="st">"https://data.sfgov.org/resource/tmnf-yvry.json?$query=SELECT%20pdid%2C</span><span class="sc">%20i</span><span class="st">ncidntnum%2C</span><span class="sc">%20i</span><span class="st">ncident_code%2C</span><span class="sc">%20c</span><span class="st">ategory%2C</span><span class="sc">%20d</span><span class="st">escript%2C</span><span class="sc">%20d</span><span class="st">ayofweek%2C</span><span class="sc">%20d</span><span class="st">ate%2C%20time%2C%20pddistrict%2C</span><span class="sc">%20r</span><span class="st">esolution%2C%20address%2C</span><span class="sc">%20x</span><span class="st">%2C%20y%2C</span><span class="sc">%20lo</span><span class="st">cation%20ORDER%20BY</span><span class="sc">%20%</span><span class="st">3Aid%20ASC"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url_crime)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>crime <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'Latitude' and  'Longitude' from the original dataset</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>old_cols <span class="op">=</span> [<span class="st">'y'</span>, <span class="st">'x'</span>]</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>crime <span class="op">=</span> crime[old_cols].copy()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>crime.rename(columns<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(old_cols, new_cols)), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the dataset into geodataframe</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>crime[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]] <span class="op">=</span> crime[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>crime[<span class="st">"geometry"</span>]<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(crime[<span class="st">"Longitude"</span>],crime[<span class="st">"Latitude"</span>]))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>crime[<span class="st">"geometry"</span>]<span class="op">=</span>crime[<span class="st">"geometry"</span>].<span class="bu">apply</span>(Point)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>crime<span class="op">=</span>gpd.GeoDataFrame(crime,geometry<span class="op">=</span><span class="st">"geometry"</span>,crs<span class="op">=</span>{<span class="st">'init'</span>: <span class="st">'epsg:4326'</span>}).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).dropna()</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 2.0 Add 311 data</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data during URL</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>url_311 <span class="op">=</span> <span class="st">"https://data.sfgov.org/resource/vw6y-z8j6.json?$query=SELECT</span><span class="sc">%20s</span><span class="st">ervice_request_id%2C</span><span class="sc">%20r</span><span class="st">equested_datetime%2C</span><span class="sc">%20c</span><span class="st">losed_date%2C</span><span class="sc">%20u</span><span class="st">pdated_datetime%2C</span><span class="sc">%20s</span><span class="st">tatus_description%2C</span><span class="sc">%20s</span><span class="st">tatus_notes%2C%20agency_responsible%2C</span><span class="sc">%20s</span><span class="st">ervice_name%2C</span><span class="sc">%20s</span><span class="st">ervice_subtype%2C</span><span class="sc">%20s</span><span class="st">ervice_details%2C%20address%2C</span><span class="sc">%20s</span><span class="st">treet%2C</span><span class="sc">%20s</span><span class="st">upervisor_district%2C%20neighborhoods_sffind_boundaries%2C%20police_district%2C%20lat%2C</span><span class="sc">%20lo</span><span class="st">ng%2C%20point%2C</span><span class="sc">%20s</span><span class="st">ource%2C%20media_url%2C%20bos_2012%20ORDER%20BY</span><span class="sc">%20s</span><span class="st">ervice_request_id%20DESC"</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url_311)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>data_311 <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'Latitude' and  'Longitude' from the original dataset</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>old_cols <span class="op">=</span> [<span class="st">'lat'</span>, <span class="st">'long'</span>]</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>data_311 <span class="op">=</span> data_311[old_cols].copy()</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>data_311.rename(columns<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(old_cols, new_cols)), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the dataset into geodataframe</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>data_311[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]] <span class="op">=</span> data_311[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>data_311[<span class="st">"geometry"</span>]<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(data_311[<span class="st">"Longitude"</span>],data_311[<span class="st">"Latitude"</span>]))</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>data_311[<span class="st">"geometry"</span>]<span class="op">=</span>data_311[<span class="st">"geometry"</span>].<span class="bu">apply</span>(Point)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>data_311<span class="op">=</span>gpd.GeoDataFrame(data_311,geometry<span class="op">=</span><span class="st">"geometry"</span>,crs<span class="op">=</span>{<span class="st">'init'</span>: <span class="st">'epsg:4326'</span>}).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).dropna()</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 3.0 Add Civic Art Collection data</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data during URL</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>url_art <span class="op">=</span> <span class="st">"https://data.sfgov.org/resource/r7bn-7v9c.json?$query=SELECT</span><span class="sc">%20c</span><span class="st">reation_date%2C%20accession_number%2C%20artist%2C</span><span class="sc">%20c</span><span class="st">redit_line%2C</span><span class="sc">%20d</span><span class="st">isplay_title%2C</span><span class="sc">%20d</span><span class="st">isplay_dimensions%2C%20medium%2C%20media_support%2C</span><span class="sc">%20f</span><span class="st">acility%2C</span><span class="sc">%20c</span><span class="st">urrent_location%2C</span><span class="sc">%20lo</span><span class="st">cation_description%2C</span><span class="sc">%20s</span><span class="st">treet_address_or_intersection%2C%20zip_code%2C%20latitude%2C</span><span class="sc">%20lo</span><span class="st">ngitude%2C%20number_of_districts%2C</span><span class="sc">%20c</span><span class="st">ultural_districts%2C</span><span class="sc">%20s</span><span class="st">upervisor_district%2C%20the_geom%20ORDER%20BY</span><span class="sc">%20%</span><span class="st">3Aid%20ASC"</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url_art)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>art <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'Latitude' and  'Longitude' from the original dataset</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>old_cols <span class="op">=</span> [<span class="st">'latitude'</span>, <span class="st">'longitude'</span>]</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>art <span class="op">=</span> art[old_cols].copy()</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>art.rename(columns<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(old_cols, new_cols)), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the dataset into geodataframe</span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>art[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]] <span class="op">=</span> art[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>art[<span class="st">"geometry"</span>]<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(art[<span class="st">"Longitude"</span>],art[<span class="st">"Latitude"</span>]))</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>art[<span class="st">"geometry"</span>]<span class="op">=</span>art[<span class="st">"geometry"</span>].<span class="bu">apply</span>(Point)</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>art<span class="op">=</span>gpd.GeoDataFrame(art,geometry<span class="op">=</span><span class="st">"geometry"</span>,crs<span class="op">=</span>{<span class="st">'init'</span>: <span class="st">'epsg:4326'</span>}).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).dropna()</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 4.0 Add Recreation and Parks Properties data</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data during URL</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>url_park <span class="op">=</span> <span class="st">"https://data.sfgov.org/resource/gtr9-ntp6.json"</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url_park)</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>park <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'Latitude' and  'Longitude' from the original dataset</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>old_cols <span class="op">=</span> [<span class="st">'latitude'</span>, <span class="st">'longitude'</span>]</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>park <span class="op">=</span> park[old_cols].copy()</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>park.rename(columns<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(old_cols, new_cols)), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the dataset into geodataframe</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>park[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]] <span class="op">=</span> park[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>park[<span class="st">"geometry"</span>]<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(park[<span class="st">"Longitude"</span>],park[<span class="st">"Latitude"</span>]))</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>park[<span class="st">"geometry"</span>]<span class="op">=</span>park[<span class="st">"geometry"</span>].<span class="bu">apply</span>(Point)</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>park<span class="op">=</span>gpd.GeoDataFrame(park,geometry<span class="op">=</span><span class="st">"geometry"</span>,crs<span class="op">=</span>{<span class="st">'init'</span>: <span class="st">'epsg:4326'</span>}).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).dropna()</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 5.0 Add Bicycle Parking data</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data during URL</span></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>url_bike <span class="op">=</span> <span class="st">"https://data.sfgov.org/resource/hn4j-6fx5.json?$query=SELECT</span><span class="sc">%20o</span><span class="st">bjectid%2C%20address%2C</span><span class="sc">%20lo</span><span class="st">cation%2C</span><span class="sc">%20s</span><span class="st">treet%2C%20placement%2C</span><span class="sc">%20r</span><span class="st">acks%2C</span><span class="sc">%20s</span><span class="st">paces%2C</span><span class="sc">%20g</span><span class="st">lobalid%2C</span><span class="sc">%20i</span><span class="st">nstall_yr%2C</span><span class="sc">%20i</span><span class="st">nstall_mo%2C%20lat%2C</span><span class="sc">%20lo</span><span class="st">n%2C</span><span class="sc">%20s</span><span class="st">hape%20ORDER%20BY</span><span class="sc">%20%</span><span class="st">3Aid%20ASC"</span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url_bike)</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>bike <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'Latitude' and  'Longitude' from the original dataset</span></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>old_cols <span class="op">=</span> [<span class="st">'lat'</span>, <span class="st">'lon'</span>]</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>bike <span class="op">=</span> bike[old_cols].copy()</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>bike.rename(columns<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(old_cols, new_cols)), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the dataset into geodataframe</span></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>bike[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]] <span class="op">=</span> bike[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>bike[<span class="st">"geometry"</span>]<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(bike[<span class="st">"Longitude"</span>],bike[<span class="st">"Latitude"</span>]))</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>bike[<span class="st">"geometry"</span>]<span class="op">=</span>bike[<span class="st">"geometry"</span>].<span class="bu">apply</span>(Point)</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>bike<span class="op">=</span>gpd.GeoDataFrame(bike,geometry<span class="op">=</span><span class="st">"geometry"</span>,crs<span class="op">=</span>{<span class="st">'init'</span>: <span class="st">'epsg:4326'</span>}).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).dropna()</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 6.0 Add Restaurant data</span></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data during URL</span></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>url_school <span class="op">=</span> <span class="st">"https://data.sfgov.org/resource/pyih-qa8i.json"</span></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url_school)</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>resta <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 'Latitude' and  'Longitude' from the original dataset</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a>old_cols <span class="op">=</span> [<span class="st">'business_latitude'</span>, <span class="st">'business_longitude'</span>]</span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>new_cols <span class="op">=</span> [<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>resta <span class="op">=</span> resta[old_cols].copy()</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>resta.rename(columns<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(old_cols, new_cols)), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the dataset into geodataframe</span></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>resta[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]] <span class="op">=</span> resta[[<span class="st">"Latitude"</span>,<span class="st">"Longitude"</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>resta[<span class="st">"geometry"</span>]<span class="op">=</span><span class="bu">list</span>(<span class="bu">zip</span>(resta[<span class="st">"Longitude"</span>],resta[<span class="st">"Latitude"</span>]))</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>resta[<span class="st">"geometry"</span>]<span class="op">=</span>resta[<span class="st">"geometry"</span>].<span class="bu">apply</span>(Point)</span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>resta<span class="op">=</span>gpd.GeoDataFrame(resta,geometry<span class="op">=</span><span class="st">"geometry"</span>,crs<span class="op">=</span>{<span class="st">'init'</span>: <span class="st">'epsg:4326'</span>}).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/watson/mambaforge/envs/musa-550-fall-2023/lib/python3.10/site-packages/pyproj/crs/crs.py:141: FutureWarning: '+init=&lt;authority&gt;:&lt;code&gt;' syntax is deprecated. '&lt;authority&gt;:&lt;code&gt;' is the preferred initialization method. When making the change, be mindful of axis order changes: https://pyproj4.github.io/pyproj/stable/gotchas.html#axis-order-changes-in-proj-6
  in_crs_string = _prepare_from_proj_string(in_crs_string)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="150">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>90.000000</td>
<td>-120.500000</td>
<td>POINT (-13413998.641 242528680.944)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>37.770767</td>
<td>-122.421595</td>
<td>POINT (-13627909.564 4547093.357)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>37.769868</td>
<td>-122.422367</td>
<td>POINT (-13627995.602 4546966.729)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>37.745745</td>
<td>-122.452717</td>
<td>POINT (-13631374.069 4543570.132)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>37.712164</td>
<td>-122.448127</td>
<td>POINT (-13630863.178 4538843.604)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="feature-add" class="level3">
<h3 class="anchored" data-anchor-id="feature-add">2.2.3 Feature Add</h3>
<div class="cell" data-tags="[]" data-execution_count="161">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> NearestNeighbors</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function to extract x/y from dataset</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_xy_from_geometry(df):</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Return a numpy array with two columns, where the </span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">    first holds the `x` geometry coordinate and the second </span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">    column holds the `y` geometry coordinate</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> df.geometry.x</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df.geometry.y</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.column_stack((x, y)) </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract x/y from airbnb</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>airbnbXY<span class="op">=</span>get_xy_from_geometry(airbnb_gpd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="167">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 1.0 KNN method of six features via the following 6 steps</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step1: Extract x/y from crime</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step2: Initialize the algorithm</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step3: Fit the algorithm on the "neighbors" dataset</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step4: Get distances for airbnb to </span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step5: Average distance to neighbors</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step6: Set zero distances to be small, but nonzero</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.1 KNN of crime</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>crimeXY<span class="op">=</span>get_xy_from_geometry(crime) </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>nbrs.fit(crimeXY) </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>criDists, criIndices <span class="op">=</span> nbrs.kneighbors(airbnbXY) </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>avgCriDist_crime <span class="op">=</span> criDists.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>avgCriDist_crime[avgCriDist_crime<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-5</span> </span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2 KNN of 311</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>data_311XY<span class="op">=</span>get_xy_from_geometry(data_311) </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>nbrs.fit(data_311XY) </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>criDists, criIndices <span class="op">=</span> nbrs.kneighbors(airbnbXY) </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>avgCriDist_311 <span class="op">=</span> criDists.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>avgCriDist_311[avgCriDist_311<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-5</span> </span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.3 KNN of art</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>artXY<span class="op">=</span>get_xy_from_geometry(art) </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>nbrs.fit(artXY) </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>criDists, criIndices <span class="op">=</span> nbrs.kneighbors(airbnbXY) </span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>avgCriDist_art <span class="op">=</span> criDists.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>avgCriDist_art[avgCriDist_art<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-5</span> </span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.4 KNN of park</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>parkXY<span class="op">=</span>get_xy_from_geometry(park) </span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>nbrs.fit(parkXY) </span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>criDists, criIndices <span class="op">=</span> nbrs.kneighbors(airbnbXY) </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>avgCriDist_park <span class="op">=</span> criDists.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>avgCriDist_park[avgCriDist_park<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-5</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.5 KNN of bike</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>bikeXY<span class="op">=</span>get_xy_from_geometry(bike) </span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>nbrs.fit(bikeXY) </span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>criDists, criIndices <span class="op">=</span> nbrs.kneighbors(airbnbXY) </span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>avgCriDist_bike <span class="op">=</span> criDists.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>avgCriDist_bike[avgCriDist_bike<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-5</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.6 KNN of resta</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>restaXY<span class="op">=</span>get_xy_from_geometry(resta) </span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>nbrs.fit(restaXY) </span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>criDists, criIndices <span class="op">=</span> nbrs.kneighbors(airbnbXY) </span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>avgCriDist_resta <span class="op">=</span> criDists.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>avgCriDist_resta[avgCriDist_resta<span class="op">==</span><span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-5</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 2.0 Calculate log of distances of six features</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>airbnb_gpd[<span class="st">'log_crime'</span>] <span class="op">=</span> np.log10(avgCriDist_crime)</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>airbnb_gpd[<span class="st">'log_311'</span>] <span class="op">=</span> np.log10(avgCriDist_311)</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>airbnb_gpd[<span class="st">'log_art'</span>] <span class="op">=</span> np.log10(avgCriDist_art)</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>airbnb_gpd[<span class="st">'log_park'</span>] <span class="op">=</span> np.log10(avgCriDist_park)</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>airbnb_gpd[<span class="st">'log_bike'</span>] <span class="op">=</span> np.log10(avgCriDist_bike)</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>airbnb_gpd[<span class="st">'log_resta'</span>] <span class="op">=</span> np.log10(avgCriDist_resta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="168">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>airbnb_gpd.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="168">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">host_acceptance_rate</th>
<th data-quarto-table-cell-role="th">host_identity_verified</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">number_of_reviews_l30d</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">host_year</th>
<th data-quarto-table-cell-role="th">last_review_days</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">coordinate</th>
<th data-quarto-table-cell-role="th">log_crime</th>
<th data-quarto-table-cell-role="th">log_311</th>
<th data-quarto-table-cell-role="th">log_art</th>
<th data-quarto-table-cell-role="th">log_park</th>
<th data-quarto-table-cell-role="th">log_bike</th>
<th data-quarto-table-cell-role="th">log_resta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>958</td>
<td>Western Addition</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.77028</td>
<td>-122.43317</td>
<td>187</td>
<td>3</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>405</td>
<td>1</td>
<td>4.87</td>
<td>2.36</td>
<td>1</td>
<td>2</td>
<td>30</td>
<td>2008</td>
<td>133</td>
<td>62.333333</td>
<td>1</td>
<td>POINT (-13629198.141 4547024.716)</td>
<td>2.438247</td>
<td>2.473138</td>
<td>2.626526</td>
<td>2.793330</td>
<td>2.350033</td>
<td>2.371349</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5858</td>
<td>Bernal Heights</td>
<td>80.0</td>
<td>71.0</td>
<td>t</td>
<td>37.74474</td>
<td>-122.42089</td>
<td>235</td>
<td>4</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>111</td>
<td>0</td>
<td>4.88</td>
<td>0.64</td>
<td>1</td>
<td>30</td>
<td>60</td>
<td>2009</td>
<td>2325</td>
<td>58.750000</td>
<td>1</td>
<td>POINT (-13627831.137 4543428.629)</td>
<td>2.386006</td>
<td>2.695961</td>
<td>2.157961</td>
<td>2.722494</td>
<td>2.092105</td>
<td>1.958029</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8142</td>
<td>Haight Ashbury</td>
<td>100.0</td>
<td>88.0</td>
<td>t</td>
<td>37.76555</td>
<td>-122.45213</td>
<td>56</td>
<td>1</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>10</td>
<td>0</td>
<td>4.70</td>
<td>0.09</td>
<td>15</td>
<td>32</td>
<td>90</td>
<td>2009</td>
<td>141</td>
<td>56.000000</td>
<td>1</td>
<td>POINT (-13631308.758 4546358.628)</td>
<td>2.584913</td>
<td>2.408406</td>
<td>2.950024</td>
<td>2.848271</td>
<td>2.450163</td>
<td>2.683513</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8339</td>
<td>Western Addition</td>
<td>100.0</td>
<td>0.0</td>
<td>t</td>
<td>37.77564</td>
<td>-122.43642</td>
<td>480</td>
<td>2</td>
<td>f</td>
<td>Entire home/apt</td>
<td>1.0</td>
<td>28</td>
<td>0</td>
<td>4.87</td>
<td>0.16</td>
<td>2</td>
<td>5</td>
<td>91</td>
<td>2009</td>
<td>1634</td>
<td>240.000000</td>
<td>1</td>
<td>POINT (-13629559.929 4547779.573)</td>
<td>2.416063</td>
<td>2.463375</td>
<td>2.907497</td>
<td>2.852972</td>
<td>2.242407</td>
<td>2.565325</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8739</td>
<td>Mission</td>
<td>100.0</td>
<td>96.0</td>
<td>t</td>
<td>37.76030</td>
<td>-122.42197</td>
<td>122</td>
<td>3</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>792</td>
<td>5</td>
<td>4.92</td>
<td>4.62</td>
<td>2</td>
<td>1</td>
<td>26</td>
<td>2009</td>
<td>119</td>
<td>40.666667</td>
<td>1</td>
<td>POINT (-13627951.362 4545619.363)</td>
<td>2.365501</td>
<td>2.327283</td>
<td>2.605696</td>
<td>2.718618</td>
<td>2.174633</td>
<td>2.350898</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="172">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 3.0 Plot all six features in the same figure</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>,nrows<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">25</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [(<span class="fl">0.0</span>, <span class="st">"red"</span>), (<span class="fl">0.5</span>, <span class="st">"blue"</span>), (<span class="fl">1.0</span>, <span class="st">"yellow"</span>)]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>custom_cmap <span class="op">=</span> mcolors.LinearSegmentedColormap.from_list(<span class="st">"custom_colormap"</span>, colors, N<span class="op">=</span><span class="dv">256</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.1 log_crime</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>axs[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>hb<span class="op">=</span>ax.hexbin(airbnbXY[:,<span class="dv">0</span>], airbnbXY[:,<span class="dv">1</span>], C<span class="op">=</span>airbnb_gpd[<span class="st">'log_crime'</span>].values,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>             cmap<span class="op">=</span>custom_cmap,gridsize<span class="op">=</span><span class="dv">80</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>plt.colorbar(hb,ax<span class="op">=</span>ax,fraction<span class="op">=</span><span class="fl">0.03</span>,pad<span class="op">=</span><span class="fl">0.04</span>).set_label(<span class="st">'log_crime'</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.2 log_311</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>axs[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>hb<span class="op">=</span>ax.hexbin(airbnbXY[:,<span class="dv">0</span>], airbnbXY[:,<span class="dv">1</span>], C<span class="op">=</span>airbnb_gpd[<span class="st">'log_311'</span>].values,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>             cmap<span class="op">=</span>custom_cmap,gridsize<span class="op">=</span><span class="dv">80</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>plt.colorbar(hb,ax<span class="op">=</span>ax,fraction<span class="op">=</span><span class="fl">0.03</span>,pad<span class="op">=</span><span class="fl">0.04</span>).set_label(<span class="st">'log_311'</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3 log_art</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>axs[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>hb<span class="op">=</span>ax.hexbin(airbnbXY[:,<span class="dv">0</span>], airbnbXY[:,<span class="dv">1</span>], C<span class="op">=</span>airbnb_gpd[<span class="st">'log_art'</span>].values,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>             cmap<span class="op">=</span>custom_cmap,gridsize<span class="op">=</span><span class="dv">80</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>plt.colorbar(hb,ax<span class="op">=</span>ax,fraction<span class="op">=</span><span class="fl">0.03</span>,pad<span class="op">=</span><span class="fl">0.04</span>).set_label(<span class="st">'log_art'</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.4 log_park</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>axs[<span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>hb<span class="op">=</span>ax.hexbin(airbnbXY[:,<span class="dv">0</span>], airbnbXY[:,<span class="dv">1</span>], C<span class="op">=</span>airbnb_gpd[<span class="st">'log_park'</span>].values,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>             cmap<span class="op">=</span>custom_cmap,gridsize<span class="op">=</span><span class="dv">80</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>plt.colorbar(hb,ax<span class="op">=</span>ax,fraction<span class="op">=</span><span class="fl">0.03</span>,pad<span class="op">=</span><span class="fl">0.04</span>).set_label(<span class="st">'log_park'</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.5 log_bike</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>axs[<span class="dv">2</span>][<span class="dv">0</span>]</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>hb<span class="op">=</span>ax.hexbin(airbnbXY[:,<span class="dv">0</span>], airbnbXY[:,<span class="dv">1</span>], C<span class="op">=</span>airbnb_gpd[<span class="st">'log_bike'</span>].values,</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>             cmap<span class="op">=</span>custom_cmap,gridsize<span class="op">=</span><span class="dv">80</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>plt.colorbar(hb,ax<span class="op">=</span>ax,fraction<span class="op">=</span><span class="fl">0.03</span>,pad<span class="op">=</span><span class="fl">0.04</span>).set_label(<span class="st">'log_bike'</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.6 log_resta</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>axs[<span class="dv">2</span>][<span class="dv">1</span>]</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>hb<span class="op">=</span>ax.hexbin(airbnbXY[:,<span class="dv">0</span>], airbnbXY[:,<span class="dv">1</span>], C<span class="op">=</span>airbnb_gpd[<span class="st">'log_resta'</span>].values,</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>             cmap<span class="op">=</span>custom_cmap,gridsize<span class="op">=</span><span class="dv">80</span>,alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>nhood.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>ax, crs<span class="op">=</span>airbnb_gpd.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>plt.colorbar(hb,ax<span class="op">=</span>ax,fraction<span class="op">=</span><span class="fl">0.03</span>,pad<span class="op">=</span><span class="fl">0.04</span>).set_label(<span class="st">'log_resta'</span>,size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'./diagram/features_collected'</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="173">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==&gt; 4.0 Add the lagged sales variable</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>nbrs <span class="op">=</span> NearestNeighbors(n_neighbors<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>nbrs.fit(airbnbXY)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>priceDists, priceIndices <span class="op">=</span> nbrs.kneighbors(airbnbXY)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the sales for the stations from original data frame</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>price <span class="op">=</span> airbnb_gpd[<span class="st">'price'</span>].values</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># get the trips for the 5 nearest neighbors (ignoring first match)</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>neighboring_price <span class="op">=</span>  price[priceIndices[:,<span class="dv">1</span>:]]</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># add to features</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>airbnb_gpd[<span class="st">'LaggedPrice'</span>] <span class="op">=</span> neighboring_price.mean(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="173">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">host_acceptance_rate</th>
<th data-quarto-table-cell-role="th">host_identity_verified</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">number_of_reviews_l30d</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">host_year</th>
<th data-quarto-table-cell-role="th">last_review_days</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">coordinate</th>
<th data-quarto-table-cell-role="th">log_crime</th>
<th data-quarto-table-cell-role="th">log_311</th>
<th data-quarto-table-cell-role="th">log_art</th>
<th data-quarto-table-cell-role="th">log_park</th>
<th data-quarto-table-cell-role="th">log_bike</th>
<th data-quarto-table-cell-role="th">log_resta</th>
<th data-quarto-table-cell-role="th">LaggedPrice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>958</td>
<td>Western Addition</td>
<td>100.0</td>
<td>100.0</td>
<td>t</td>
<td>37.77028</td>
<td>-122.43317</td>
<td>187</td>
<td>3</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>405</td>
<td>1</td>
<td>4.87</td>
<td>2.36</td>
<td>1</td>
<td>2</td>
<td>30</td>
<td>2008</td>
<td>133</td>
<td>62.333333</td>
<td>1</td>
<td>POINT (-13629198.141 4547024.716)</td>
<td>2.438247</td>
<td>2.473138</td>
<td>2.626526</td>
<td>2.793330</td>
<td>2.350033</td>
<td>2.371349</td>
<td>370.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5858</td>
<td>Bernal Heights</td>
<td>80.0</td>
<td>71.0</td>
<td>t</td>
<td>37.74474</td>
<td>-122.42089</td>
<td>235</td>
<td>4</td>
<td>f</td>
<td>Entire home/apt</td>
<td>2.0</td>
<td>111</td>
<td>0</td>
<td>4.88</td>
<td>0.64</td>
<td>1</td>
<td>30</td>
<td>60</td>
<td>2009</td>
<td>2325</td>
<td>58.750000</td>
<td>1</td>
<td>POINT (-13627831.137 4543428.629)</td>
<td>2.386006</td>
<td>2.695961</td>
<td>2.157961</td>
<td>2.722494</td>
<td>2.092105</td>
<td>1.958029</td>
<td>104.75</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8142</td>
<td>Haight Ashbury</td>
<td>100.0</td>
<td>88.0</td>
<td>t</td>
<td>37.76555</td>
<td>-122.45213</td>
<td>56</td>
<td>1</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>10</td>
<td>0</td>
<td>4.70</td>
<td>0.09</td>
<td>15</td>
<td>32</td>
<td>90</td>
<td>2009</td>
<td>141</td>
<td>56.000000</td>
<td>1</td>
<td>POINT (-13631308.758 4546358.628)</td>
<td>2.584913</td>
<td>2.408406</td>
<td>2.950024</td>
<td>2.848271</td>
<td>2.450163</td>
<td>2.683513</td>
<td>79.75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8339</td>
<td>Western Addition</td>
<td>100.0</td>
<td>0.0</td>
<td>t</td>
<td>37.77564</td>
<td>-122.43642</td>
<td>480</td>
<td>2</td>
<td>f</td>
<td>Entire home/apt</td>
<td>1.0</td>
<td>28</td>
<td>0</td>
<td>4.87</td>
<td>0.16</td>
<td>2</td>
<td>5</td>
<td>91</td>
<td>2009</td>
<td>1634</td>
<td>240.000000</td>
<td>1</td>
<td>POINT (-13629559.929 4547779.573)</td>
<td>2.416063</td>
<td>2.463375</td>
<td>2.907497</td>
<td>2.852972</td>
<td>2.242407</td>
<td>2.565325</td>
<td>222.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8739</td>
<td>Mission</td>
<td>100.0</td>
<td>96.0</td>
<td>t</td>
<td>37.76030</td>
<td>-122.42197</td>
<td>122</td>
<td>3</td>
<td>f</td>
<td>Private room</td>
<td>1.0</td>
<td>792</td>
<td>5</td>
<td>4.92</td>
<td>4.62</td>
<td>2</td>
<td>1</td>
<td>26</td>
<td>2009</td>
<td>119</td>
<td>40.666667</td>
<td>1</td>
<td>POINT (-13627951.362 4545619.363)</td>
<td>2.365501</td>
<td>2.327283</td>
<td>2.605696</td>
<td>2.718618</td>
<td>2.174633</td>
<td>2.350898</td>
<td>167.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="correlation-analysis" class="level2">
<h2 class="anchored" data-anchor-id="correlation-analysis">2.3 Correlation Analysis</h2>
<div class="cell" data-tags="[]" data-execution_count="180">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>value <span class="op">=</span> <span class="bu">bool</span>(<span class="va">True</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>feature_cols <span class="op">=</span> [</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>     <span class="st">'host_year'</span>, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>     <span class="st">'host_response_rate'</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">'accommodates'</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>     <span class="st">'beds'</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>     <span class="st">'number_of_reviews'</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>     <span class="st">'review_scores_rating'</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>     <span class="st">'reviews_per_month'</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>     <span class="st">'calculated_host_listings_count'</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>     <span class="st">'minimum_nights'</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>     <span class="st">'last_review_days'</span>,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_crime'</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_311'</span>,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_art'</span>,</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_park'</span>,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_bike'</span>,</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_resta'</span>,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>     <span class="st">'LaggedPrice'</span>,</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>     <span class="st">'price'</span>,</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>     <span class="st">'price_per_person'</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>     ]</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the figure and axes</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>fx, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the correlation matrix</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> airbnb_gpd[feature_cols].corr()</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a mask for the upper triangle</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.zeros_like(corr, dtype<span class="op">=</span><span class="bu">bool</span>)  <span class="co"># Use bool directly instead of np.bool</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>mask[np.triu_indices_from(mask)] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a custom diverging colormap</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> sns.diverging_palette(<span class="dv">10</span>, <span class="dv">230</span>, as_cmap<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>heatmap <span class="op">=</span> sns.heatmap(corr, mask<span class="op">=</span>mask, cmap<span class="op">=</span>cmap, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, linewidths<span class="op">=</span><span class="fl">.5</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">.5</span>})</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>figure <span class="op">=</span> heatmap.get_figure() </span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>figure.savefig(<span class="st">"./diagram/correlation.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">2.4 Model Building</h2>
<div class="cell" data-tags="[]" data-execution_count="267">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cols_price<span class="op">=</span>[</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>     <span class="st">'host_year'</span>,  </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">'host_response_rate'</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>     <span class="st">'accommodates'</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>     <span class="st">'beds'</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>     <span class="st">'number_of_reviews'</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">'review_scores_rating'</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>     <span class="st">'reviews_per_month'</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>     <span class="st">'calculated_host_listings_count'</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>     <span class="st">'minimum_nights'</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>     <span class="st">'last_review_days'</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_crime'</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_311'</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_art'</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_park'</span>,</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_bike'</span>,</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_resta'</span>,</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>     <span class="st">'LaggedPrice'</span>,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>     <span class="st">'price'</span>,</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>     <span class="st">'host_identity_verified'</span>,</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>     <span class="st">'instant_bookable'</span>,</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>     <span class="st">'neighbourhood'</span>,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>     <span class="st">'room_type'</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>     <span class="st">'coordinate'</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>     ]</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>price<span class="op">=</span>airbnb_gpd[cols_price].dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="268">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a 70/30% training/test split</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>train_set, test_set <span class="op">=</span> train_test_split(price, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the target labels</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.log(train_set[<span class="st">"price"</span>])</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> np.log(test_set[<span class="st">"price"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="269">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a pipeline that includes both numerical columns and categorical columns</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Numerical columns</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>     <span class="st">'host_year'</span>, </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>     <span class="st">'host_response_rate'</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>     <span class="st">'accommodates'</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>     <span class="st">'beds'</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">'number_of_reviews'</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>     <span class="st">'review_scores_rating'</span>,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>     <span class="st">'reviews_per_month'</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>     <span class="st">'calculated_host_listings_count'</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>     <span class="st">'minimum_nights'</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>     <span class="st">'last_review_days'</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_crime'</span>,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_311'</span>,</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_art'</span>,</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_park'</span>,</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_bike'</span>,</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>     <span class="st">'log_resta'</span>,</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>     <span class="st">'LaggedPrice'</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical columns</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [ <span class="st">'host_identity_verified'</span>,</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>             <span class="st">'instant_bookable'</span>,</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>             <span class="st">'neighbourhood'</span>,</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>             <span class="st">'room_type'</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>           ]</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the column transformer with two transformers</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the numerical columns and one-hot </span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, StandardScaler(), num_cols),</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>), cat_cols),</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="co">#Initialize the pipeline</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>regressor <span class="op">=</span> make_pipeline(</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>    preprocessor, RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="270">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the score on the test set using the best_params_ </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>regressor <span class="op">=</span> make_pipeline(preprocessor, RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>,max_depth<span class="op">=</span><span class="dv">13</span>,random_state<span class="op">=</span><span class="dv">42</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the training set</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>regressor.fit(train_set, y_train)<span class="op">;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  the test score</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Testing Score = </span><span class="sc">{</span>regressor<span class="sc">.</span>score(test_set, y_test)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Testing Score = 0.34280431620306995</code></pre>
</div>
</div>
</section>
<section id="predict" class="level2">
<h2 class="anchored" data-anchor-id="predict">2.6 Predict</h2>
<div class="cell" data-tags="[]" data-execution_count="271">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hvplot.pandas</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_feature_importances(regr, num_cols, preprocessor, top<span class="op">=</span><span class="dv">20</span>, <span class="op">**</span>kwargs):</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Utility function to plot the feature importances from the input</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">    random forest regressor</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The one-hot step</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    ohe <span class="op">=</span> preprocessor.named_transformers_[<span class="st">"cat"</span>]</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># One column for each category type!</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    ohe_cols <span class="op">=</span> ohe.get_feature_names_out()</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Full list of columns is numerical + one-hot</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> num_cols <span class="op">+</span> <span class="bu">list</span>(ohe_cols)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The regressor</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    regressor <span class="op">=</span> regr[<span class="st">"randomforestregressor"</span>]</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the dataframe with importances</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> pd.DataFrame(</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"Feature"</span>: features, <span class="st">"Importance"</span>: regressor.feature_importances_}</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort importance in descending order and get the top</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> importance.sort_values(<span class="st">"Importance"</span>, ascending<span class="op">=</span><span class="va">False</span>).iloc[:top]</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> importance.hvplot.barh(x<span class="op">=</span><span class="st">"Feature"</span>, y<span class="op">=</span><span class="st">"Importance"</span>,line_color<span class="op">=</span><span class="st">"white"</span>,color<span class="op">=</span><span class="st">"#71c9ce"</span>, flip_yaxis<span class="op">=</span><span class="va">True</span>, <span class="op">**</span>kwargs)</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>imp<span class="op">=</span>plot_feature_importances(regressor, num_cols, preprocessor, top<span class="op">=</span><span class="dv">30</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>hvplot.save(imp, <span class="st">'./diagram/importance_bar.html'</span>)</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="271">
<div id="p1529">
  <div id="ecdf5516-dd01-4843-a424-74b265263d6a" data-root-id="p1529" style="display: contents;"></div>
</div>
<script type="application/javascript">(function(root) {
  var docs_json = {"94d3b191-5caa-4c6c-bd54-80e40d7f721d":{"version":"3.2.1","title":"Bokeh Application","roots":[{"type":"object","name":"Row","id":"p1529","attributes":{"name":"Row01654","tags":["embedded"],"stylesheets":["\n:host(.pn-loading.pn-arc):before, .pn-loading.pn-arc:before {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0eWxlPSJtYXJnaW46IGF1dG87IGJhY2tncm91bmQ6IG5vbmU7IGRpc3BsYXk6IGJsb2NrOyBzaGFwZS1yZW5kZXJpbmc6IGF1dG87IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiPiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzNjM2MzIiBzdHJva2Utd2lkdGg9IjEwIiByPSIzNSIgc3Ryb2tlLWRhc2hhcnJheT0iMTY0LjkzMzYxNDMxMzQ2NDE1IDU2Ljk3Nzg3MTQzNzgyMTM4Ij4gICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjFzIiB2YWx1ZXM9IjAgNTAgNTA7MzYwIDUwIDUwIiBrZXlUaW1lcz0iMDsxIj48L2FuaW1hdGVUcmFuc2Zvcm0+ICA8L2NpcmNsZT48L3N2Zz4=\");\n  background-size: auto calc(min(50%, 400px));\n}",{"type":"object","name":"ImportedStyleSheet","id":"p1532","attributes":{"url":"https://cdn.holoviz.org/panel/1.2.1/dist/css/loading.css"}},{"type":"object","name":"ImportedStyleSheet","id":"p1584","attributes":{"url":"https://cdn.holoviz.org/panel/1.2.1/dist/css/listpanel.css"}},{"type":"object","name":"ImportedStyleSheet","id":"p1530","attributes":{"url":"https://cdn.holoviz.org/panel/1.2.1/dist/bundled/theme/default.css"}},{"type":"object","name":"ImportedStyleSheet","id":"p1531","attributes":{"url":"https://cdn.holoviz.org/panel/1.2.1/dist/bundled/theme/native.css"}}],"min_width":700,"margin":0,"sizing_mode":"stretch_width","align":"start","children":[{"type":"object","name":"Spacer","id":"p1533","attributes":{"name":"HSpacer01663","stylesheets":["\n:host(.pn-loading.pn-arc):before, .pn-loading.pn-arc:before {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0eWxlPSJtYXJnaW46IGF1dG87IGJhY2tncm91bmQ6IG5vbmU7IGRpc3BsYXk6IGJsb2NrOyBzaGFwZS1yZW5kZXJpbmc6IGF1dG87IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiPiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzNjM2MzIiBzdHJva2Utd2lkdGg9IjEwIiByPSIzNSIgc3Ryb2tlLWRhc2hhcnJheT0iMTY0LjkzMzYxNDMxMzQ2NDE1IDU2Ljk3Nzg3MTQzNzgyMTM4Ij4gICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjFzIiB2YWx1ZXM9IjAgNTAgNTA7MzYwIDUwIDUwIiBrZXlUaW1lcz0iMDsxIj48L2FuaW1hdGVUcmFuc2Zvcm0+ICA8L2NpcmNsZT48L3N2Zz4=\");\n  background-size: auto calc(min(50%, 400px));\n}",{"id":"p1532"},{"id":"p1530"},{"id":"p1531"}],"margin":0,"sizing_mode":"stretch_width","align":"start"}},{"type":"object","name":"Figure","id":"p1541","attributes":{"width":700,"height":500,"margin":[5,10],"sizing_mode":"fixed","align":"start","x_range":{"type":"object","name":"Range1d","id":"p1534","attributes":{"tags":[[["Importance","Importance",null]],[]],"end":0.1954798338910663,"reset_start":0.0,"reset_end":0.1954798338910663}},"y_range":{"type":"object","name":"FactorRange","id":"p1535","attributes":{"tags":[[["Feature","Feature",null]],{"type":"map","entries":[["invert_yaxis",true],["autorange",false]]}],"factors":["neighbourhood_Noe Valley","neighbourhood_Nob Hill","neighbourhood_Pacific Heights","neighbourhood_Castro/Upper Market","room_type_Private room","instant_bookable_t","instant_bookable_f","room_type_Shared room","neighbourhood_Marina","neighbourhood_Russian Hill","neighbourhood_Inner Sunset","host_response_rate","neighbourhood_Western Addition","number_of_reviews","log_park","host_year","log_art","review_scores_rating","log_resta","log_311","log_bike","calculated_host_listings_count","room_type_Entire home/apt","log_crime","last_review_days","reviews_per_month","minimum_nights","LaggedPrice","beds","accommodates"]}},"x_scale":{"type":"object","name":"LinearScale","id":"p1551"},"y_scale":{"type":"object","name":"CategoricalScale","id":"p1552"},"title":{"type":"object","name":"Title","id":"p1544","attributes":{"text_color":"black","text_font_size":"12pt"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1577","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1568","attributes":{"selected":{"type":"object","name":"Selection","id":"p1569","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1570"},"data":{"type":"map","entries":[["Feature",["accommodates","beds","LaggedPrice","minimum_nights","reviews_per_month","last_review_days","log_crime","room_type_Entire home/apt","calculated_host_listings_count","log_bike","log_311","log_resta","review_scores_rating","log_art","host_year","log_park","number_of_reviews","neighbourhood_Western Addition","host_response_rate","neighbourhood_Inner Sunset","neighbourhood_Russian Hill","neighbourhood_Marina","room_type_Shared room","instant_bookable_f","instant_bookable_t","room_type_Private room","neighbourhood_Castro/Upper Market","neighbourhood_Pacific Heights","neighbourhood_Nob Hill","neighbourhood_Noe Valley"]],["Importance",{"type":"ndarray","array":{"type":"bytes","data":"u201bsbHxj9gRFs5hym0PxXzEDioB7M/z29lu7M8rj+qvoDIvyWsP0QChVYNCKs/igFNgZ9Wqj8NUw71youmPx4dwreKV6Y/O5ZQTDDzoj+w4Of5XOCiP41uMRk9RqE/q1iLMV9Znj9aZvyZe7ecP+HLJdqstZw/X3ISQOkonD/5nAWnS1GXP+KVuuDoeIw/a7fwidsVij+b/V9Qz7aJPxZHaa1yeIc/+tiqbXvpgz+HJTwsfRV8P21ZfIIiK3k/jIUTxpHsdz+Rfd0QrQ12P2YTuYKL7mo/aC8bJzKdaj9d9iFI2V5qP6BFPhZwrGc/"},"shape":[30],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1578","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1579"}}},"glyph":{"type":"object","name":"HBar","id":"p1574","attributes":{"tags":["apply_ranges"],"y":{"type":"field","field":"Feature"},"height":{"type":"value","value":0.8},"right":{"type":"field","field":"Importance"},"line_color":{"type":"value","value":"white"},"fill_color":{"type":"value","value":"#71c9ce"},"hatch_color":{"type":"value","value":"#71c9ce"}}},"selection_glyph":{"type":"object","name":"HBar","id":"p1580","attributes":{"tags":["apply_ranges"],"y":{"type":"field","field":"Feature"},"height":{"type":"value","value":0.8},"left":{"type":"value","value":0},"right":{"type":"field","field":"Importance"},"line_color":{"type":"value","value":"white"},"line_alpha":{"type":"value","value":1.0},"line_width":{"type":"value","value":1},"line_join":{"type":"value","value":"bevel"},"line_cap":{"type":"value","value":"butt"},"line_dash":{"type":"value","value":[]},"line_dash_offset":{"type":"value","value":0},"fill_color":{"type":"value","value":"#71c9ce"},"fill_alpha":{"type":"value","value":1.0},"hatch_color":{"type":"value","value":"#71c9ce"},"hatch_alpha":{"type":"value","value":1.0},"hatch_scale":{"type":"value","value":12.0},"hatch_pattern":{"type":"value","value":null},"hatch_weight":{"type":"value","value":1.0}}},"nonselection_glyph":{"type":"object","name":"HBar","id":"p1575","attributes":{"tags":["apply_ranges"],"y":{"type":"field","field":"Feature"},"height":{"type":"value","value":0.8},"right":{"type":"field","field":"Importance"},"line_color":{"type":"value","value":"white"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"#71c9ce"},"fill_alpha":{"type":"value","value":0.1},"hatch_color":{"type":"value","value":"#71c9ce"},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"HBar","id":"p1576","attributes":{"tags":["apply_ranges"],"y":{"type":"field","field":"Feature"},"height":{"type":"value","value":0.8},"right":{"type":"field","field":"Importance"},"line_color":{"type":"value","value":"white"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"#71c9ce"},"fill_alpha":{"type":"value","value":0.2},"hatch_color":{"type":"value","value":"#71c9ce"},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1550","attributes":{"tools":[{"type":"object","name":"WheelZoomTool","id":"p1539","attributes":{"tags":["hv_created"],"zoom_together":"none"}},{"type":"object","name":"HoverTool","id":"p1540","attributes":{"tags":["hv_created"],"renderers":[{"id":"p1577"}],"tooltips":[["Feature","@{Feature}"],["Importance","@{Importance}"]]}},{"type":"object","name":"SaveTool","id":"p1563"},{"type":"object","name":"PanTool","id":"p1564"},{"type":"object","name":"BoxZoomTool","id":"p1565","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1566","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"ResetTool","id":"p1567"}],"active_drag":{"id":"p1564"},"active_scroll":{"id":"p1539"}}},"left":[{"type":"object","name":"CategoricalAxis","id":"p1558","attributes":{"ticker":{"type":"object","name":"CategoricalTicker","id":"p1559"},"formatter":{"type":"object","name":"CategoricalTickFormatter","id":"p1560"},"axis_label":"Feature","major_label_policy":{"type":"object","name":"AllLabels","id":"p1561"}}}],"below":[{"type":"object","name":"LinearAxis","id":"p1553","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1554","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1555"},"axis_label":"Importance","major_label_policy":{"type":"object","name":"AllLabels","id":"p1556"}}}],"center":[{"type":"object","name":"Grid","id":"p1557","attributes":{"axis":{"id":"p1553"},"grid_line_color":null}},{"type":"object","name":"Grid","id":"p1562","attributes":{"dimension":1,"axis":{"id":"p1558"},"grid_line_color":null}}],"min_border_top":10,"min_border_bottom":10,"min_border_left":10,"min_border_right":10,"output_backend":"webgl"}},{"type":"object","name":"Spacer","id":"p1582","attributes":{"name":"HSpacer01666","stylesheets":["\n:host(.pn-loading.pn-arc):before, .pn-loading.pn-arc:before {\n  background-image: url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0eWxlPSJtYXJnaW46IGF1dG87IGJhY2tncm91bmQ6IG5vbmU7IGRpc3BsYXk6IGJsb2NrOyBzaGFwZS1yZW5kZXJpbmc6IGF1dG87IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiPiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzNjM2MzIiBzdHJva2Utd2lkdGg9IjEwIiByPSIzNSIgc3Ryb2tlLWRhc2hhcnJheT0iMTY0LjkzMzYxNDMxMzQ2NDE1IDU2Ljk3Nzg3MTQzNzgyMTM4Ij4gICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjFzIiB2YWx1ZXM9IjAgNTAgNTA7MzYwIDUwIDUwIiBrZXlUaW1lcz0iMDsxIj48L2FuaW1hdGVUcmFuc2Zvcm0+ICA8L2NpcmNsZT48L3N2Zz4=\");\n  background-size: auto calc(min(50%, 400px));\n}",{"id":"p1532"},{"id":"p1530"},{"id":"p1531"}],"margin":0,"sizing_mode":"stretch_width","align":"start"}}]}}],"defs":[{"type":"model","name":"ReactiveHTML1"},{"type":"model","name":"FlexBox1","properties":[{"name":"align_content","kind":"Any","default":"flex-start"},{"name":"align_items","kind":"Any","default":"flex-start"},{"name":"flex_direction","kind":"Any","default":"row"},{"name":"flex_wrap","kind":"Any","default":"wrap"},{"name":"justify_content","kind":"Any","default":"flex-start"}]},{"type":"model","name":"FloatPanel1","properties":[{"name":"config","kind":"Any","default":{"type":"map"}},{"name":"contained","kind":"Any","default":true},{"name":"position","kind":"Any","default":"right-top"},{"name":"offsetx","kind":"Any","default":null},{"name":"offsety","kind":"Any","default":null},{"name":"theme","kind":"Any","default":"primary"},{"name":"status","kind":"Any","default":"normalized"}]},{"type":"model","name":"GridStack1","properties":[{"name":"mode","kind":"Any","default":"warn"},{"name":"ncols","kind":"Any","default":null},{"name":"nrows","kind":"Any","default":null},{"name":"allow_resize","kind":"Any","default":true},{"name":"allow_drag","kind":"Any","default":true},{"name":"state","kind":"Any","default":[]}]},{"type":"model","name":"drag1","properties":[{"name":"slider_width","kind":"Any","default":5},{"name":"slider_color","kind":"Any","default":"black"},{"name":"value","kind":"Any","default":50}]},{"type":"model","name":"click1","properties":[{"name":"terminal_output","kind":"Any","default":""},{"name":"debug_name","kind":"Any","default":""},{"name":"clears","kind":"Any","default":0}]},{"type":"model","name":"FastWrapper1","properties":[{"name":"object","kind":"Any","default":null},{"name":"style","kind":"Any","default":null}]},{"type":"model","name":"NotificationAreaBase1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0}]},{"type":"model","name":"NotificationArea1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"notifications","kind":"Any","default":[]},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0},{"name":"types","kind":"Any","default":[{"type":"map","entries":[["type","warning"],["background","#ffc107"],["icon",{"type":"map","entries":[["className","fas fa-exclamation-triangle"],["tagName","i"],["color","white"]]}]]},{"type":"map","entries":[["type","info"],["background","#007bff"],["icon",{"type":"map","entries":[["className","fas fa-info-circle"],["tagName","i"],["color","white"]]}]]}]}]},{"type":"model","name":"Notification","properties":[{"name":"background","kind":"Any","default":null},{"name":"duration","kind":"Any","default":3000},{"name":"icon","kind":"Any","default":null},{"name":"message","kind":"Any","default":""},{"name":"notification_type","kind":"Any","default":null},{"name":"_destroyed","kind":"Any","default":false}]},{"type":"model","name":"TemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"BootstrapTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"MaterialTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]}]}};
  var render_items = [{"docid":"94d3b191-5caa-4c6c-bd54-80e40d7f721d","roots":{"p1529":"ecdf5516-dd01-4843-a424-74b265263d6a"},"root_ids":["p1529"]}];
  var docs = Object.values(docs_json)
  if (!docs) {
    return
  }
  const py_version = docs[0].version.replace('rc', '-rc.').replace('.dev', '-dev.')
  const is_dev = py_version.indexOf("+") !== -1 || py_version.indexOf("-") !== -1
  function embed_document(root) {
    var Bokeh = get_bokeh(root)
    Bokeh.embed.embed_items_notebook(docs_json, render_items);
    for (const render_item of render_items) {
      for (const root_id of render_item.root_ids) {
    const id_el = document.getElementById(root_id)
    if (id_el.children.length && (id_el.children[0].className === 'bk-root')) {
      const root_el = id_el.children[0]
      root_el.id = root_el.id + '-rendered'
    }
      }
    }
  }
  function get_bokeh(root) {
    if (root.Bokeh === undefined) {
      return null
    } else if (root.Bokeh.version !== py_version && !is_dev) {
      if (root.Bokeh.versions === undefined || !root.Bokeh.versions.has(py_version)) {
    return null
      }
      return root.Bokeh.versions.get(py_version);
    } else if (root.Bokeh.version === py_version) {
      return root.Bokeh
    }
    return null
  }
  function is_loaded(root) {
    var Bokeh = get_bokeh(root)
    return (Bokeh != null && Bokeh.Panel !== undefined)
  }
  if (is_loaded(root)) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (is_loaded(root)) {
        clearInterval(timer);
        embed_document(root);
      } else if (document.readyState == "complete") {
        attempts++;
        if (attempts > 200) {
          clearInterval(timer);
      var Bokeh = get_bokeh(root)
      if (Bokeh == null || Bokeh.Panel == null) {
            console.warn("Panel: ERROR: Unable to run Panel code because Bokeh or Panel library is missing");
      } else {
        console.warn("Panel: WARNING: Attempting to render but not all required libraries could be resolved.")
        embed_document(root)
      }
        }
      }
    }, 25, root)
  }
})(window);</script>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="272">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions for log of total trip counts</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>log_predictions <span class="op">=</span> regressor.predict(test_set)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the predicted test values from log</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>test_set[<span class="st">'prediction'</span>] <span class="op">=</span> np.exp(log_predictions)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>test_set[<span class="st">'percent_error'</span>]<span class="op">=</span>(test_set[<span class="st">'prediction'</span>]<span class="op">-</span>test_set[<span class="st">'price'</span>])<span class="op">/</span>test_set[<span class="st">'prediction'</span>]</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>test_set[<span class="st">'abs_percent_error'</span>]<span class="op">=</span><span class="bu">abs</span>(test_set[<span class="st">'percent_error'</span>])</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the airbnb count by neighborhood</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>abs_nei<span class="op">=</span>test_set.groupby([<span class="st">"neighbourhood"</span>])[<span class="st">"abs_percent_error"</span>].mean()</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>abs_nei<span class="op">=</span>pd.DataFrame(abs_nei).reset_index()</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>abs_nei<span class="op">=</span>nhood.merge(abs_nei,on<span class="op">=</span><span class="st">"neighbourhood"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="273">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>test_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="273">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">host_year</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">last_review_days</th>
<th data-quarto-table-cell-role="th">log_crime</th>
<th data-quarto-table-cell-role="th">log_311</th>
<th data-quarto-table-cell-role="th">log_art</th>
<th data-quarto-table-cell-role="th">log_park</th>
<th data-quarto-table-cell-role="th">log_bike</th>
<th data-quarto-table-cell-role="th">log_resta</th>
<th data-quarto-table-cell-role="th">LaggedPrice</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">host_identity_verified</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">neighbourhood</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">coordinate</th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">percent_error</th>
<th data-quarto-table-cell-role="th">abs_percent_error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5972</td>
<td>2020</td>
<td>100.0</td>
<td>4</td>
<td>2.0</td>
<td>2</td>
<td>5.00</td>
<td>0.19</td>
<td>14</td>
<td>2</td>
<td>340</td>
<td>2.270763</td>
<td>2.064503</td>
<td>2.231732</td>
<td>2.565864</td>
<td>2.460853</td>
<td>2.479059</td>
<td>150.75</td>
<td>131</td>
<td>t</td>
<td>f</td>
<td>Downtown/Civic Center</td>
<td>Entire home/apt</td>
<td>POINT (-13627872.325 4548347.160)</td>
<td>215.618750</td>
<td>0.392446</td>
<td>0.392446</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">620</td>
<td>2014</td>
<td>100.0</td>
<td>6</td>
<td>3.0</td>
<td>39</td>
<td>4.89</td>
<td>0.35</td>
<td>1</td>
<td>2</td>
<td>340</td>
<td>2.829116</td>
<td>2.932763</td>
<td>2.940149</td>
<td>2.848138</td>
<td>3.032383</td>
<td>3.220961</td>
<td>353.50</td>
<td>621</td>
<td>t</td>
<td>f</td>
<td>Twin Peaks</td>
<td>Entire home/apt</td>
<td>POINT (-13630795.575 4543836.893)</td>
<td>72.403538</td>
<td>-7.576929</td>
<td>7.576929</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4261</td>
<td>2020</td>
<td>100.0</td>
<td>2</td>
<td>1.0</td>
<td>13</td>
<td>5.00</td>
<td>0.43</td>
<td>4</td>
<td>30</td>
<td>201</td>
<td>2.572000</td>
<td>2.459310</td>
<td>2.951267</td>
<td>2.838103</td>
<td>2.635427</td>
<td>2.576596</td>
<td>231.50</td>
<td>200</td>
<td>t</td>
<td>f</td>
<td>Pacific Heights</td>
<td>Entire home/apt</td>
<td>POINT (-13629672.362 4549835.991)</td>
<td>132.159749</td>
<td>-0.513320</td>
<td>0.513320</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3719</td>
<td>2020</td>
<td>100.0</td>
<td>6</td>
<td>3.0</td>
<td>8</td>
<td>5.00</td>
<td>1.83</td>
<td>2</td>
<td>3</td>
<td>121</td>
<td>2.313734</td>
<td>2.781310</td>
<td>2.458128</td>
<td>2.729949</td>
<td>2.369446</td>
<td>2.568670</td>
<td>298.00</td>
<td>675</td>
<td>f</td>
<td>f</td>
<td>Mission</td>
<td>Entire home/apt</td>
<td>POINT (-13626655.603 4545177.236)</td>
<td>343.257873</td>
<td>-0.966452</td>
<td>0.966452</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5336</td>
<td>2017</td>
<td>100.0</td>
<td>6</td>
<td>3.0</td>
<td>1</td>
<td>5.00</td>
<td>0.06</td>
<td>8</td>
<td>30</td>
<td>588</td>
<td>2.772270</td>
<td>3.272024</td>
<td>3.248074</td>
<td>3.079585</td>
<td>3.237465</td>
<td>3.353485</td>
<td>100.00</td>
<td>194</td>
<td>t</td>
<td>t</td>
<td>Bayview</td>
<td>Entire home/apt</td>
<td>POINT (-13622344.200 4541276.358)</td>
<td>63.277373</td>
<td>-2.065867</td>
<td>2.065867</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3944</td>
<td>2012</td>
<td>100.0</td>
<td>1</td>
<td>1.0</td>
<td>7</td>
<td>4.71</td>
<td>0.24</td>
<td>23</td>
<td>30</td>
<td>202</td>
<td>2.472840</td>
<td>2.399109</td>
<td>2.745379</td>
<td>2.608093</td>
<td>2.462304</td>
<td>2.346706</td>
<td>136.50</td>
<td>74</td>
<td>t</td>
<td>t</td>
<td>Western Addition</td>
<td>Private room</td>
<td>POINT (-13628797.390 4547535.928)</td>
<td>65.688293</td>
<td>-0.126533</td>
<td>0.126533</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1316</td>
<td>2013</td>
<td>100.0</td>
<td>5</td>
<td>5.0</td>
<td>121</td>
<td>4.88</td>
<td>1.35</td>
<td>7</td>
<td>30</td>
<td>256</td>
<td>2.115881</td>
<td>2.584117</td>
<td>2.403650</td>
<td>2.645915</td>
<td>2.202797</td>
<td>2.473800</td>
<td>97.00</td>
<td>500</td>
<td>t</td>
<td>f</td>
<td>Mission</td>
<td>Entire home/apt</td>
<td>POINT (-13627127.598 4545440.539)</td>
<td>219.570470</td>
<td>-1.277173</td>
<td>1.277173</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6262</td>
<td>2022</td>
<td>100.0</td>
<td>8</td>
<td>4.0</td>
<td>2</td>
<td>5.00</td>
<td>0.28</td>
<td>2</td>
<td>30</td>
<td>246</td>
<td>2.668124</td>
<td>2.671466</td>
<td>2.704201</td>
<td>2.753143</td>
<td>2.675993</td>
<td>2.598566</td>
<td>258.75</td>
<td>169</td>
<td>t</td>
<td>f</td>
<td>Castro/Upper Market</td>
<td>Entire home/apt</td>
<td>POINT (-13629693.780 4545162.509)</td>
<td>224.136678</td>
<td>0.245996</td>
<td>0.245996</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3351</td>
<td>2016</td>
<td>100.0</td>
<td>2</td>
<td>1.0</td>
<td>4</td>
<td>4.75</td>
<td>0.09</td>
<td>48</td>
<td>2</td>
<td>234</td>
<td>2.274353</td>
<td>1.881382</td>
<td>2.490948</td>
<td>2.568636</td>
<td>2.560734</td>
<td>2.114605</td>
<td>120.00</td>
<td>95</td>
<td>t</td>
<td>t</td>
<td>Chinatown</td>
<td>Entire home/apt</td>
<td>POINT (-13626337.230 4550081.099)</td>
<td>96.565609</td>
<td>0.016213</td>
<td>0.016213</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2438</td>
<td>2018</td>
<td>100.0</td>
<td>4</td>
<td>2.0</td>
<td>116</td>
<td>4.81</td>
<td>1.83</td>
<td>3</td>
<td>1</td>
<td>114</td>
<td>2.737564</td>
<td>2.743015</td>
<td>3.124985</td>
<td>3.067772</td>
<td>2.918207</td>
<td>2.698198</td>
<td>88.75</td>
<td>139</td>
<td>t</td>
<td>t</td>
<td>Parkside</td>
<td>Entire home/apt</td>
<td>POINT (-13635497.711 4543339.939)</td>
<td>139.328114</td>
<td>0.002355</td>
<td>0.002355</td>
</tr>
</tbody>
</table>

<p>1546 rows × 26 columns</p>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="277">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot two columns</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>), facecolor<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted values</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>test_set.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>], column<span class="op">=</span><span class="st">'percent_error'</span>, marker<span class="op">=</span><span class="st">'.'</span>,cmap<span class="op">=</span><span class="st">"GnBu"</span>,alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>            legend<span class="op">=</span><span class="va">True</span>,legend_kwds<span class="op">=</span><span class="bu">dict</span>(loc<span class="op">=</span><span class="st">'upper left'</span>),scheme<span class="op">=</span><span class="st">"Quantiles"</span>,k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>axs[<span class="dv">0</span>], crs<span class="op">=</span>test_set.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">"Distribution of Percent Error"</span>,size<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual values</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>abs_nei.plot(ax<span class="op">=</span>axs[<span class="dv">1</span>],column<span class="op">=</span><span class="st">"abs_percent_error"</span>,edgecolor<span class="op">=</span><span class="st">"white"</span>,alpha<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>              legend<span class="op">=</span><span class="va">True</span>,legend_kwds<span class="op">=</span><span class="bu">dict</span>(loc<span class="op">=</span><span class="st">'upper left'</span>),cmap<span class="op">=</span><span class="st">"YlGnBu"</span>,scheme<span class="op">=</span><span class="st">"Quantiles"</span>,k<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>axs[<span class="dv">1</span>], crs<span class="op">=</span>test_set.crs, source<span class="op">=</span>ctx.providers.CartoDB.DarkMatter)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">"Mean Absolute Percent Error by Neighbourhood"</span>,size<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_axis_off()</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_axis_off()</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'./diagram/model_validation.png'</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fairbnb_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© CC-Van Archer, 2023</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>